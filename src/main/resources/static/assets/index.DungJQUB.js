import"./styles.DOGbScOT.js";import{t as e,g as t}from"./translations.Bk1Sg78H.js";let n=[],o=new Set,a="",s=!1,i=null,l="all",r=localStorage.getItem("previousUrl")||"/";function c(e){return e.toLowerCase().replace(/\s+/g,"").replace(/[^a-z]/g,"")}function d(){const e=window.location.pathname.split("/"),t=e.indexOf("country");return-1!==t&&e.length>t+1?e[t+1]:null}function u(){return"/starred"===window.location.pathname}function m(e){for(const t of o)if(c(t)===e)return t;return null}function g(e){if(u()||(r=window.location.pathname,localStorage.setItem("previousUrl",r)),"all"===e)window.history.pushState({country:"all"},"","/");else{const t=c(e);window.history.pushState({country:e},"",`/country/${t}`)}}function p(t){if("all"!==t&&t){const n=e(t.replace(/\s+/g,""));document.title=`${n} - VARUN.SURF`}else document.title="VARUN.SURF - Kitesurfing Weather Forecast"}function v(){const e=localStorage.getItem("favoriteSpots");return e?JSON.parse(e):[]}async function f(){s=!0;document.getElementById("favoritesToggle").classList.add("active");const t=document.getElementById("spotsGrid"),o=v();if(0!==o.length)try{0===n.length&&(n=await I());const e=n.filter(e=>o.includes(e.name));t.innerHTML="",e.forEach(e=>{t.appendChild(R(e))}),P()}catch(a){console.error("Failed to load favorites:",a.message),E(a)}else t.innerHTML=`\n                <div class="error-message">\n                    <span class="error-icon">‚≠ê</span>\n                    <div class="error-title">${e("noFavoritesTitle")}</div>\n                    <div class="error-description">\n                        ${e("noFavoritesDescription")}\n                    </div>\n                </div>\n            `}function y(){document.getElementById("favoritesToggle").addEventListener("click",()=>{K&&ne({skipRender:!0}),s?w():(localStorage.setItem("showingFavorites","true"),u()||(r=window.location.pathname,localStorage.setItem("previousUrl",r)),window.history.pushState({starred:!0},"","/starred"),document.title=`${e("favoritesToggleTooltip")} - VARUN.SURF`,f()),window.scrollTo({top:0,behavior:"smooth"})});"true"===localStorage.getItem("showingFavorites")&&f()}function w(e={}){if(!s)return;const{skipRender:t=!1,skipScroll:n=!1}=e;s=!1,localStorage.setItem("showingFavorites","false");const o=document.getElementById("favoritesToggle");if(o&&o.classList.remove("active"),function(){const e=r||"/";if(window.history.pushState({},"",e),"/"===e)p("all");else{const e=d();if(e){const t=m(e);t&&p(t)}}}(),!t){q(localStorage.getItem("selectedCountry")||"all","")}n||window.scrollTo({top:0,behavior:"smooth"})}function h(){const t=localStorage.getItem("language")||"en",o=document.getElementById("languageToggle");function i(t){localStorage.setItem("language",t),function(){p(localStorage.getItem("selectedCountry")||"all");const t=document.getElementById("searchInput");t&&(t.placeholder=e("searchPlaceholder"));const i=document.getElementById("themeToggle");i&&(i.title=e("themeToggleTooltip"));const r=document.getElementById("favoritesToggle");r&&(r.title=e("favoritesToggleTooltip"));const c=document.getElementById("infoToggle");c&&(c.title=e("infoToggleTooltip"));const d=document.getElementById("infoToggleLabel");d&&(d.textContent=e("infoButtonLabel"));const u=document.getElementById("mapToggleLabel");u&&(u.textContent=e("mapButtonLabel"));const m=document.getElementById("kiteSizeToggle");m&&(m.title=e("kiteSizeToggleTooltip"));const g=document.getElementById("columnToggle");g&&(g.title=e("columnToggleTooltip"));o&&(o.title=e("languageToggleTooltip"));const v=document.getElementById("langCode");v&&(v.textContent=e("langCode"));const y=document.querySelector(".footer-disclaimer");y&&(y.textContent=e("footerDisclaimer"));if(n.length>0)x(n);else{A(localStorage.getItem("selectedCountry")||"all")}const w=document.getElementById("dropdownMenu");if(w){const t=w.querySelector('[data-country="all"]');t&&(t.textContent=`üåé ${e("allCountries")}`)}const h=document.querySelector(".loading-text");h&&(h.textContent=e("loadingText"));const I=document.getElementById("appInfoModalTitle");I&&(I.textContent=e("appInfoModalTitle"));const E=document.getElementById("appInfoDescription");E&&(E.textContent=e("appInfoDescription"));const L=document.getElementById("appInfoContactTitle");L&&(L.textContent=e("appInfoContactTitle"));const $=document.getElementById("appInfoContactText");$&&($.innerHTML=e("appInfoContactText"));const b=document.getElementById("appInfoNewSpotTitle");b&&(b.textContent=e("appInfoNewSpotTitle"));const T=document.getElementById("appInfoNewSpotText");T&&(T.innerHTML=e("appInfoNewSpotText"));const S=document.getElementById("appInfoCollaborationTitle");S&&(S.textContent=e("appInfoCollaborationTitle"));const k=document.getElementById("appInfoCollaborationText");k&&(k.innerHTML=e("appInfoCollaborationText"));const C=document.querySelector("#kiteSizeModal .modal-title span");C&&(C.textContent=e("kiteSizeCalculatorTitle"));const B=document.querySelector('label[for="windSpeed"]');B&&(B.textContent=e("windSpeedLabel"));const M=document.getElementById("windSpeed");M&&(M.placeholder=e("windSpeedPlaceholder"));const N=document.querySelector('label[for="riderWeight"]');N&&(N.textContent=e("riderWeightLabel"));const D=document.getElementById("riderWeight");D&&(D.placeholder=e("riderWeightPlaceholder"));const H=document.querySelector('label[for="skillLevel"]');H&&(H.textContent=e("skillLevelLabel"));const F=document.getElementById("skillLevel");if(F){const t=F.querySelectorAll("option");t[0].textContent=e("skillLevelPlaceholder"),t[1].textContent=e("skillBeginnerFlat"),t[2].textContent=e("skillBeginnerSmall"),t[3].textContent=e("skillIntermediateFlat"),t[4].textContent=e("skillIntermediateMedium"),t[5].textContent=e("skillAdvancedFlat"),t[6].textContent=e("skillAdvancedMedium"),t[7].textContent=e("skillAdvancedLarge")}const W=document.getElementById("calculateBtn");W&&(W.textContent=e("calculateButton"));const R=document.querySelector("#calcResult .calc-result-title");R&&(R.textContent=e("recommendedEquipment"));const U=document.querySelector("#calcResult .calc-result-item:nth-child(2) .calc-result-label");U&&(U.textContent=e("kiteSizeLabel"));const O=document.querySelector("#calcResult .calc-result-item:nth-child(3) .calc-result-label");O&&(O.textContent=e("boardSizeLabel"));const G=document.querySelector("#calcResult .modal-disclaimer");G&&(G.textContent=e("calcDisclaimer"));const P=document.querySelector("#aiModal .modal-disclaimer");P&&(P.textContent=e("aiDisclaimer"));n.length>0&&(s?f():q(l,a,!0))}()}i(t),o.addEventListener("click",()=>{i("en"===(localStorage.getItem("language")||"en")?"pl":"en")})}async function I(){try{const e=await fetch("/api/v1/spots",{cache:"no-store"});if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);const t=await e.json();if(!Array.isArray(t))throw new Error("Invalid data format: Expected array of spots");return t}catch(e){throw console.error("Error fetching weather data:",e),e}}function E(t){const n=document.getElementById("spotsGrid");let o=e("errorLoadDataTitle"),a=e("errorLoadDataDescription");t.message.includes("HTTP Error: 404")?(o=e("errorDataNotFoundTitle"),a=e("errorDataNotFoundDescription")):t.message.includes("HTTP Error: 500")?(o=e("errorServerTitle"),a=e("errorServerDescription")):t.message.includes("Failed to fetch")||t.message.includes("NetworkError")?(o=e("errorConnectionTitle"),a=e("errorConnectionDescription")):(t.message.includes("JSON")||t.message.includes("Invalid data format"))&&(o=e("errorDataFormatTitle"),a=e("errorDataFormatDescription")),n.innerHTML=`\n                <div class="error-message">\n                    <span class="error-icon">‚ö†Ô∏è</span>\n                    <div class="error-title">${o}</div>\n                    <div class="error-description">\n                        ${a}<br/>\n                        ${e("errorRefresh")}\n                    </div>\n                </div>\n            `}function $(e){return{N:"‚Üì",NE:"‚Üô",E:"‚Üê",SE:"‚Üñ",S:"‚Üë",SW:"‚Üó",W:"‚Üí",NW:"‚Üò"}[e]||"‚Ä¢"}function b(e){return e<12?"wind-weak":e>=12&&e<18?"wind-moderate":e>=18&&e<=25?"wind-strong":"wind-extreme"}function T(t){return{Mon:e("dayMon"),Tue:e("dayTue"),Wed:e("dayWed"),Thu:e("dayThu"),Fri:e("dayFri"),Sat:e("daySat"),Sun:e("daySun"),Today:e("dayToday"),Tomorrow:e("dayTomorrow"),"Day 3":e("dayDay3"),"Day 4":e("dayDay4"),"Day 5":e("dayDay5")}[t]||t}function S(e){if(!e||"string"!=typeof e)return"";const t=e.trim().split(/\s+/);if(t.length<5){return T(e)||e}const[n,o,,,a]=t,s=T(n),i=o.padStart(2,"0");if(window.innerWidth<=768){const e=a.split(":")[0];return`${s.substring(0,2)} ${e}`.trim()}return`${i}. ${s} ${a}`.trim()}function k(e){if(!e)return new Date;try{const t=e.trim().split(/\s+/);if(t.length>=5){const e=parseInt(t[1]),n=t[2],o=parseInt(t[3]),a=t[4].split(":"),s=parseInt(a[0]),i=parseInt(a[1]),l={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[n];if(void 0!==l){const t=new Date(o,l,e,s,i);if(!isNaN(t.getTime()))return t}}}catch(t){console.warn("Error parsing forecast date:",e,t)}return new Date}function C(e){if("number"==typeof e&&Number.isFinite(e))return e;const t=Number(e);return Number.isFinite(t)?t:null}function B(e){if(!e)return null;if(Array.isArray(e.forecastHourly)&&e.forecastHourly.length>0){const t=function(e){if(!Array.isArray(e)||0===e.length)return null;const t=new Date;let n=e[0],o=Math.abs(k(e[0].date)-t);for(let a=1;a<e.length;a++){const s=k(e[a].date),i=Math.abs(s-t);i<o&&(o=i,n=e[a])}return n}(e.forecastHourly);if(t)return t}if(Array.isArray(e.forecast)&&e.forecast.length>0){return e.forecast.find(e=>"string"==typeof e.date&&"today"===e.date.toLowerCase())||e.forecast[0]}return null}function M(t){if(!t)return null;const n=t.currentConditions;if(n){const t=C(n.wind),o=C(n.gusts);if(null!==t&&null!==o)return{wind:t,gusts:o,direction:n.direction||"",temp:C(n.temp),precipitation:null,label:e("nowLabel"),isCurrent:!0}}const o=B(t);if(!o)return null;const a=C(o.wind),s=C(o.gusts);return null===a||null===s?null:{wind:a,gusts:s,direction:o.direction||"",temp:C(o.temp),precipitation:C(o.precipitation),label:S(o.date),isCurrent:!1}}function x(n){const a=document.getElementById("dropdownMenu");document.getElementById("selectedCountry"),o.clear(),n.forEach(e=>{e.country&&o.add(e.country)});const i=Array.from(o).sort((t,n)=>{const o=e(t.replace(/\s+/g,"")),a=e(n.replace(/\s+/g,""));return o.localeCompare(a)}),l=localStorage.getItem("selectedCountry")||"all",r=e("allCountries");let c=`<div class="dropdown-option ${"all"===l?"selected":""}" data-country="all">üåé ${r}</div>`;i.forEach(n=>{const o=t(n),a=l===n?"selected":"",s=e(n.replace(/\s+/g,""));c+=`<div class="dropdown-option ${a}" data-country="${n}">${o} ${s.toUpperCase()}</div>`}),a.innerHTML=c,A(l),function(){const e=document.querySelectorAll(".dropdown-option"),t=document.getElementById("searchInput");e.forEach(n=>{n.addEventListener("click",o=>{o.stopPropagation(),e.forEach(e=>e.classList.remove("selected")),n.classList.add("selected");const a=n.dataset.country;A(a),localStorage.setItem("selectedCountry",a),g(a),p(a),s&&(s=!1,localStorage.setItem("showingFavorites","false"),document.getElementById("favoritesToggle").classList.remove("active")),K&&ne({skipRender:!0}),q(a,t.value,!0),closeDropdown(),window.scrollTo({top:0,behavior:"smooth"})})})}()}function A(n){const o=document.getElementById("selectedCountry");if(!o)return;if(!n||"all"===n)return void(o.textContent=`üåé ${e("allCountries")}`);const a=t(n),s=e(n.replace(/\s+/g,""));o.textContent=`${a} ${s.toUpperCase()}`}function N(){const e=document.getElementById("appInfoModal");e&&(e.classList.add("active"),document.body.style.overflow="hidden")}function D(){const e=document.getElementById("appInfoModal");e&&(e.classList.remove("active"),document.body.style.overflow="auto")}function H(){document.getElementById("aiModal").classList.remove("active"),document.body.style.overflow="auto"}function F(){document.getElementById("infoModal").classList.remove("active"),document.body.style.overflow="auto"}function W(){document.getElementById("icmModal").classList.remove("active"),document.body.style.overflow="auto";document.getElementById("icmImage").src=""}function R(t){const n=document.createElement("div");n.className="spot-card",n.dataset.country=e(t.country.replace(/\s+/g,""));const o=t.forecast&&t.forecast.some(e=>void 0!==e.wave)||t.currentConditions&&void 0!==t.currentConditions.wave,a=M(t);let s="";t.forecast&&Array.isArray(t.forecast)&&t.forecast.forEach(e=>{const t=b(e.wind),n=b(e.gusts),a=b((e.wind+e.gusts)/2),i="wind-weak"===a?"weak-wind":"wind-moderate"===a?"moderate-wind":"wind-strong"===a?"strong-wind":"extreme-wind",l=e.temp>=18?"temp-positive":"temp-negative",r=$(e.direction),c=0===e.precipitation?"precipitation-none":"precipitation";let d="",u="-";void 0!==e.wave&&(d=e.wave<1?"wave-small":e.wave>=1&&e.wave<2?"wave-moderate":"wave-large",u=`${e.wave}`),s+=`\n                        <tr class="${i}">\n                            <td><strong>${T(e.date)}</strong></td>\n                            <td class="${t}">${e.wind} kts</td>\n                            <td class="${n}">${e.gusts} kts</td>\n                            <td class="${t}">\n                                <span class="wind-arrow">${r}</span> ${e.direction}\n                            </td>\n                            <td class="${l}">${e.temp}¬∞C</td>\n                            <td class="${c}">${e.precipitation}%</td>\n                            ${o?`<td class="${d}">${u}</td>`:""}\n                        </tr>\n                    `});let i="";if(a&&a.isCurrent){const n=a.wind,s=a.gusts,l=b(n),r=b(s),c=b((n+s)/2),d="wind-weak"===c?"weak-wind":"wind-moderate"===c?"moderate-wind":"wind-strong"===c?"strong-wind":"extreme-wind",u=Number.isFinite(a.temp),m=u?a.temp>=20?"temp-positive":"temp-negative":"",g=u?`${a.temp}¬∞C`:"-",p=$(a.direction);let v="",f="-";t.currentConditions&&void 0!==t.currentConditions.wave&&(v=t.currentConditions.wave<1?"wave-small":t.currentConditions.wave>=1&&t.currentConditions.wave<2?"wave-moderate":"wave-large",f=`${t.currentConditions.wave}`),i=`\n                    <tr class="${d}" style="border-bottom: 2px solid #404040;">\n                        <td>\n                            <div class="live-indicator">\n                                <strong class="live-text">${e("nowLabel")}</strong>\n                                <div class="live-dot"></div>\n                            </div>\n                        </td>\n                        <td class="${l}">${n} kts</td>\n                        <td class="${r}">${s} kts</td>\n                        <td class="${l}">\n                            <span class="wind-arrow">${p}</span> ${a.direction||"-"}\n                        </td>\n                        <td class="${m}">${g}</td>\n                        <td>-</td>\n                        ${o?`<td class="${v}">${f}</td>`:""}\n                    </tr>\n                `}const l=(r=t.name,v().includes(r));var r;const c=l?"favorited":"";return n.innerHTML=`\n                <div class="drag-handle" draggable="true">ìÉå</div>\n                <div class="spot-header">\n                    <div class="spot-title">\n                        <div class="spot-name" onclick="window.location.href='/spot/${t.wgId}'">${t.name||"Unknown Spot"}</div>\n                    </div>\n                    <div class="spot-meta">\n                        <div class="country-tag-wrapper">\n                            <div class="favorite-icon ${c}" onclick="toggleFavorite('${t.name}')" title="${l?"Remove from favorites":"Add to favorites"}">\n                                <svg class="favorite-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                    <path d="M1.327,12.4,4.887,15,3.535,19.187A3.178,3.178,0,0,0,4.719,22.8a3.177,3.177,0,0,0,3.8-.019L12,20.219l3.482,2.559a3.227,3.227,0,0,0,4.983-3.591L19.113,15l3.56-2.6a3.227,3.227,0,0,0-1.9-5.832H16.4L15.073,2.432a3.227,3.227,0,0,0-6.146,0L7.6,6.568H3.231a3.227,3.227,0,0,0-1.9,5.832Z"/>\n                                </svg>\n                            </div>\n                            <div class="country-tag">${e(t.country.replace(/\s+/g,""))||"Unknown"}</div>\n                        </div>\n                        <div class="last-updated">${t.lastUpdated||"No data"}</div>\n                    </div>\n                </div>\n                <div class="external-links">\n                    ${t.spotInfo?`<span class="external-link info-link" onclick="openInfoModal('${t.name}')"></span>`:""}\n                    ${t.windguruUrl?`<a href="${t.windguruUrl}" target="_blank" class="external-link">WG</a>`:""}\n                    ${t.windfinderUrl?`<a href="${t.windfinderUrl}" target="_blank" class="external-link">WF</a>`:""}\n                    ${t.icmUrl?`<span class="external-link" onclick="openIcmModal('${t.name}', '${t.icmUrl}')">ICM</span>`:""}\n                    ${t.webcamUrl?`<a href="${t.webcamUrl}" target="_blank" class="external-link webcam-link">${e("camLinkLabel")}</a>`:""}\n                    ${t.locationUrl?`<a href="${t.locationUrl}" target="_blank" class="external-link location-link">${e("mapLinkLabel")}</a>`:""}\n                    ${t.aiAnalysisEn||t.aiAnalysisPl?`<span class="external-link ai-link" onclick="openAIModal('${t.name}')">AI</span>`:""}\n                </div>\n                <table class="weather-table">\n                    <thead>\n                        <tr>\n                            <th>${e("dateHeader")}</th>\n                            <th>${e("windHeader")}</th>\n                            <th>${e("gustsHeader")}</th>\n                            <th>${e("directionHeader")}</th>\n                            <th>${e("tempHeader")}</th>\n                            <th>${e("rainHeader")}</th>\n                            ${o?`<th>${e("waveHeader")}</th>`:""}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${i}\n                        ${s}\n                    </tbody>\n                </table>\n            `,n}function U(e,t,n){let o="all"===t?e:e.filter(e=>e.country===t);if(n&&""!==n.trim()){const e=n.toLowerCase().trim();o=o.filter(t=>t.name.toLowerCase().includes(e)||t.country&&t.country.toLowerCase().includes(e))}return o}async function q(t="all",o="",s=!1,i=!1){l=t,a=o;const r=document.getElementById("spotsGrid");if(n.length>0&&!i){return void O(U(n,t,o),r,t,o)}document.getElementById("spotsGrid").innerHTML=`\n                <div class="loading-message">\n                    <div class="loading-spinner"></div>\n                    <span class="loading-text">${e("loadingText")}</span>\n                </div>\n            `;try{const e=await I();n=e,x(e);O(U(e,t,o),r,t,o)}catch(c){console.error("Failed to load weather:",c.message),E(c)}}function O(t,n,o,a){if(n.innerHTML="",0===t.length){const t=a?`${e("errorNoSpotsSearchDescription")} "${a}"`:`${e("errorNoSpotsDescription")}`;n.innerHTML=`\n                    <div class="error-message">\n                        <span class="error-icon">üîç</span>\n                        <div class="error-title">${e("errorNoSpotsTitle")}</div>\n                        <div class="error-description">\n                            ${t}<br/>\n                            ${e("errorTryAdjusting")}\n                        </div>\n                    </div>\n                `}else{t.every(e=>!e.forecast||0===e.forecast.length)?(n.innerHTML=`\n                    <div class="loading-message">\n                        <div class="loading-spinner"></div>\n                        <span class="loading-text">${e("loadingText")}</span>\n                    </div>\n                `,setTimeout(()=>{q(o,a,!1,!0)},5e3)):(t.forEach(e=>{n.appendChild(R(e))}),P())}}function G(){const e=document.getElementById("spotsGrid");let t=null,n=null;e.addEventListener("dragstart",e=>{e.target.closest(".drag-handle")?(t=e.target.closest(".spot-card"),t&&(t.classList.add("dragging"),e.dataTransfer.effectAllowed="move",n=t.cloneNode(!0),n.classList.add("drag-ghost"),n.classList.remove("dragging"),n.style.width=t.offsetWidth+"px",n.style.position="fixed",n.style.left="-9999px",n.style.top="-9999px",document.body.appendChild(n),e.dataTransfer.setDragImage(n,e.offsetX,e.offsetY))):e.preventDefault()}),e.addEventListener("dragend",()=>{t&&(t.classList.remove("dragging"),t=null,function(){const e=document.getElementById("spotsGrid"),t=e.querySelectorAll(".spot-card"),n=Array.from(t).map(e=>e.querySelector(".spot-name").textContent),o=e.classList.contains("three-columns"),s=`spotOrder_${o?"3col":"2col"}_${l}_${a}`;localStorage.setItem(s,JSON.stringify(n))}()),n&&(n.remove(),n=null)}),e.addEventListener("dragover",n=>{n.preventDefault();const o=function(e,t,n){const o=[...e.querySelectorAll(".spot-card:not(.dragging)")];let a=null,s=Number.NEGATIVE_INFINITY;return o.forEach(e=>{const o=e.getBoundingClientRect(),i=o.top+o.height/2,l=n-i,r=t-(o.left+o.width/2);if(l<0){l>s&&(s=l,a=e)}else if(r<0&&l<o.height/2){const t=r/2+l;t>s&&(s=t,a=e)}}),a}(e,n.clientX,n.clientY);t&&null==o?e.appendChild(t):t&&o&&e.insertBefore(t,o)})}function P(){const e=document.getElementById("spotsGrid"),t=`spotOrder_${e.classList.contains("three-columns")?"3col":"2col"}_${l}_${a}`,n=localStorage.getItem(t);if(n)try{const t=JSON.parse(n),o=Array.from(e.querySelectorAll(".spot-card"));t.forEach(t=>{const n=o.find(e=>e.querySelector(".spot-name").textContent===t);n&&e.appendChild(n)})}catch(o){console.error("Failed to load card order:",o)}}function z(){i&&clearInterval(i),i=setInterval(()=>{!async function(){try{const e=await I();if(n=e,x(e),s){const e=document.getElementById("spotsGrid"),t=v();n.filter(e=>t.includes(e.name)).forEach(t=>{const n=Array.from(e.querySelectorAll(".spot-card")).find(e=>{const n=e.querySelector(".spot-name");return n&&n.textContent===t.name});if(n){const e=R(t);n.replaceWith(e)}})}else{const e=U(n,l,a),t=document.getElementById("spotsGrid");e.forEach(e=>{const n=Array.from(t.querySelectorAll(".spot-card")).find(t=>{const n=t.querySelector(".spot-name");return n&&n.textContent===e.name});if(n){const t=R(e);n.replaceWith(t)}})}console.log("Data refreshed in background at",(new Date).toLocaleTimeString())}catch(e){console.error("Background refresh failed:",e)}}()},6e4),console.log("Auto-refresh started: updating every",60,"seconds")}function Z(){const e=document.getElementById("kiteSizeToggle"),t=document.getElementById("kiteSizeModal"),n=document.getElementById("kiteSizeModalClose"),o=document.getElementById("calculateBtn");function a(){t.classList.remove("active"),document.body.style.overflow="auto"}e.addEventListener("click",()=>{t.classList.add("active"),document.body.style.overflow="hidden",document.getElementById("calcResult").classList.remove("show")}),n.addEventListener("click",a),t.addEventListener("click",e=>{e.target===t&&a()}),o.addEventListener("click",()=>{const e=parseFloat(document.getElementById("windSpeed").value),t=parseFloat(document.getElementById("riderWeight").value),n=document.getElementById("skillLevel").value,o=document.getElementById("calcWarning"),a=document.getElementById("calcResult");if(o.style.display="none",a.classList.remove("show"),!e||e<5||e>50)return o.innerHTML="‚ö†Ô∏è <strong>INVALID WIND SPEED</strong><br><br>Please enter a valid wind speed between 5 and 50 knots.",void(o.style.display="block");if(!t||t>150)return o.innerHTML="‚ö†Ô∏è <strong>INVALID RIDER WEIGHT</strong><br><br>Please enter a valid rider weight between 40 and 150 kg.",void(o.style.display="block");if(t<40)return o.innerHTML="‚ö†Ô∏è <strong>WEIGHT TOO LOW</strong><br><br>Your weight is too low and riding may be dangerous. Kitesurfing requires sufficient body weight for control and safety.",void(o.style.display="block");if(!n)return o.innerHTML="‚ö†Ô∏è <strong>SKILL LEVEL REQUIRED</strong><br><br>Please select your skill level and conditions.",void(o.style.display="block");if(t>120)return o.innerHTML="üòâ Maybe you should lose some weight before going onto the water!",void(o.style.display="block");if(e>40)return o.innerHTML="‚ö†Ô∏è <strong>EXTREME CONDITIONS!</strong><br><br>Wind speeds above 40 knots are extremely dangerous. We strongly recommend NOT going onto the water in these conditions. Stay safe!",void(o.style.display="block");if(e<12)return o.innerHTML="üí® <strong>LOW WIND CONDITIONS</strong><br><br>There is not enough wind for riding with a regular setup. However, you could try going on a <strong>kite foil board</strong>, which works great in light wind conditions!",void(o.style.display="block");if(e<15&&(n.includes("medium")||n.includes("large")))return o.innerHTML="üåä <strong>INSUFFICIENT WIND FOR WAVE CONDITIONS</strong><br><br>Wind speed below 15 knots is not enough for riding in medium or large waves. Waves create additional resistance and you need more wind power to maintain speed and control. We recommend NOT going onto the water in these conditions.",void(o.style.display="block");const s=function(e,t,n){let o=2.5;const a={"beginner-flat":3,"beginner-small":2.8,"intermediate-flat":2.5,"intermediate-medium":2.3,"advanced-flat":2.2,"advanced-medium":2,"advanced-large":1.8};n&&a[n]&&(o=a[n]);let s=t*o/e;return s=[7,9,10,12,14,15,17].reduce((e,t)=>Math.abs(t-s)<Math.abs(e-s)?t:e),s}(e,t,n),i=function(e,t){let n="Twin Tip";if((t.includes("large")||t.includes("medium")&&t.includes("advanced"))&&(n="Surfboard/Directional üèÑ"),"Twin Tip"===n){let o=125;o+=.5*(Math.min(e,115)-50);const a={"beginner-flat":1.15,"beginner-small":1.1,"intermediate-flat":1,"intermediate-medium":.98,"advanced-flat":.92,"advanced-medium":.9}[t]||1;let s=Math.round(o*a);s=2*Math.round(s/2);const i=136;let l=160;(t.includes("intermediate")||t.includes("advanced"))&&(l=142),s=Math.max(i,Math.min(s,l));let r=38+Math.floor((s-136)/4);return r=Math.min(r,46),`${s} x ${r} cm (${n})`}return`${e<70?"5'6\"":e<85?"5'10\"":"6'0\""} (${n})`}(t,n);document.getElementById("kiteSize").textContent=`${s} m¬≤`,document.getElementById("boardSize").textContent=i,a.classList.add("show")}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&a()})}async function _(){const e=document.getElementById("sponsorsContainer");if(!e)return;const t=await async function(){try{const e=await fetch("/api/v1/sponsors");return e.ok&&await e.json()||[]}catch(e){return console.error("Error fetching main sponsors:",e),[]}}();if(!t||0===t.length)return void(e.innerHTML="");let n='<div class="sponsors-container"><div class="sponsors-list">';for(const o of t)n+=`\n                <div class="sponsor-item">\n                    <a href="${o.link}" target="_blank" rel="noopener noreferrer" class="sponsor-link">\n                        <span class="sponsor-name">${o.name}</span>\n                    </a>\n                </div>\n            `;n+="</div></div>",e.innerHTML=n}function V(){const t=d();if(t)I().then(o=>{n=o,x(o);const a=m(t);var s;a?(localStorage.setItem("selectedCountry",a),p(a),q(a,"",!0)):(s=t,document.getElementById("spotsGrid").innerHTML=`\n            <div class="error-message">\n                <span class="error-icon">‚ö†Ô∏è</span>\n                <div class="error-title">${e("invalidCountry")}</div>\n                <div class="error-description">\n                    ${e("invalidCountryDescription")}<br/>\n                    <br/>\n                    <strong>Invalid country: "${s}"</strong>\n                </div>\n            </div>\n        `),z()}).catch(e=>{console.error("Failed to load weather:",e.message),E(e)});else{const e=localStorage.getItem("selectedCountry")||"all";g(e),p(e),q(e),z()}}function J(){if("/map"!==window.location.pathname)if(u()){s=!0,localStorage.setItem("showingFavorites","true");const e=document.getElementById("favoritesToggle");e&&e.classList.add("active"),p("all"),f(),z()}else V();else!function(){const e=localStorage.getItem("selectedCountry")||"all";q(e,"",!0).then(()=>{p(e),te(),z()}).catch(e=>{console.error("Failed to initialize map route:",e)})}()}window.onbeforeunload=function(){window.scrollTo(0,0)};let j=null,X=[],Y=null,K=!1;function Q(){if(!j)return;const e={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:19}};e&&(Y&&j.removeLayer(Y),Y=L.tileLayer(e.url,e.options).addTo(j))}function ee(t){if(X.forEach(e=>e.remove()),X=[],!j||!t||0===t.length)return;const n=[];t.forEach(t=>{if(!t.coordinates||!t.coordinates.lat||!t.coordinates.lon)return;const o=t.coordinates.lat,a=t.coordinates.lon,s=M(t),i=s?b(s.wind):"wind-no-data",l=L.divIcon({className:"custom-marker-icon",html:`<div class="custom-marker ${i}"><div class="marker-dot"></div></div>`,iconSize:[18,18],iconAnchor:[9,9]}),r=L.marker([o,a],{icon:l}).addTo(j),c=function(t){if(!t)return"";const n=$(t.direction),o=Number.isFinite(t.gusts)?`${t.gusts} kts`:"-",a=b(t.wind),s=t.direction||"-",i=t.isCurrent?"":`<div class="map-popup-meta">${e("forecastEstimateLabel")}${t.label?` ¬∑ ${t.label}`:""}</div>`;return`\n        <div class="map-popup-wind ${a}">\n            <span class="wind-arrow">${n}</span>\n            <span class="map-popup-direction">${s}</span>\n            <span class="map-popup-speed">${t.wind} kts - ${o}</span>\n        </div>\n        ${i}\n    `}(s);r.bindPopup(`\n            <div class="map-popup">\n                <a href="/spot/${t.wgId}" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">${t.name}</a>\n                ${c}\n            </div>\n        `),X.push(r),n.push([o,a])}),n.length>0&&j.fitBounds(n,{padding:[50,50]})}function te(){s&&w({skipRender:!0,skipScroll:!0}),K=!0;const e=document.getElementById("spotsGrid"),t=document.getElementById("mapContainer"),o=document.getElementById("mapToggle");e.style.display="none",t.style.display="block",o.classList.add("active"),function(){if(j)return;document.getElementById("map")&&(j=L.map("map").setView([51.505,-.09],2),Q())}();ee(U(n,l,a)),j&&j.invalidateSize(),window.history.pushState({map:!0},"","/map"),window.scrollTo({top:0,behavior:"smooth"})}function ne(e={}){if(!K)return;const{skipRender:t=!1}=e;K=!1;const n=document.getElementById("spotsGrid"),o=document.getElementById("mapContainer"),s=document.getElementById("mapToggle");n.style.display="",o.style.display="none",s.classList.remove("active");const i="all"===l?"/":`/country/${c(l)}`;window.history.pushState({},"",i),t||q(l,a,!0)}window.openAppInfoModal=N,window.closeAppInfoModal=D,window.openAIModal=function(t){const o=n.find(e=>e.name===t),a="pl"===(localStorage.getItem("language")||"en")?o.aiAnalysisPl:o.aiAnalysisEn;if(!o||!a)return;const s=document.getElementById("aiModal"),i=document.getElementById("modalSpotName"),l=document.getElementById("aiAnalysisContent"),r=document.getElementById("aiModalDisclaimer");i.textContent=`${e("aiAnalysisTitle")} - ${t}`,l.innerHTML=a.trim(),r.textContent=e("aiDisclaimer"),s.classList.add("active"),document.body.style.overflow="hidden"},window.closeAIModal=H,window.openInfoModal=function(t){const o=n.find(e=>e.name===t);if(!o||!o.spotInfo)return;const a=document.getElementById("infoModal"),s=document.getElementById("infoModalSpotName"),i=document.getElementById("spotInfoContent");s.textContent=`${t}`;const l=function(e){return e?"pl"===(localStorage.getItem("language")||"en")?e.spotInfoPL:e.spotInfo:null}(o);i.innerHTML=`\n                <div class="info-grid">\n                    <div class="info-item" style="grid-column: 1 / -1;">\n                        <div class="info-label">${e("overviewLabel")}</div>\n                        <div class="info-value">${l.description}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("spotTypeLabel")}</div>\n                        <div class="info-value">${l.type}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("bestWindLabel")}</div>\n                        <div class="info-value">${l.bestWind}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("waterTempLabel")}</div>\n                        <div class="info-value">${l.waterTemp}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("experienceLabel")}</div>\n                        <div class="info-value">${l.experience}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("launchTypeLabel")}</div>\n                        <div class="info-value">${l.launch}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">${e("hazardsLabel")}</div>\n                        <div class="info-value">${l.hazards}</div>\n                    </div>\n                    <div class="info-item" style="grid-column: 1 / -1;">\n                        <div class="info-label">${e("seasonLabel")}</div>\n                        <div class="info-value">${l.season}</div>\n                    </div>\n                </div>\n            `,a.classList.add("active"),document.body.style.overflow="hidden"},window.closeInfoModal=F,window.openIcmModal=function(t,n){const o=document.getElementById("icmModal"),a=document.getElementById("icmModalSpotName"),s=document.getElementById("icmImage");a.textContent=`${t} - ${e("icmForecastTitle")}`,s.src=n,s.alt=`${e("icmForecastTitle")} for ${t}`,o.classList.add("active"),document.body.style.overflow="hidden"},window.closeIcmModal=W,window.toggleFavorite=function(e){let t=v();const n=t.indexOf(e);n>-1?t.splice(n,1):t.push(e),function(e){localStorage.setItem("favoriteSpots",JSON.stringify(e))}(t),document.querySelectorAll(".favorite-icon").forEach(t=>{const o=t.closest(".spot-card");if(o){const a=o.querySelector(".spot-name");a&&a.textContent===e&&(n>-1?(t.classList.remove("favorited"),t.title="Add to favorites"):(t.classList.add("favorited"),t.title="Remove from favorites"),t.classList.add("animate"),setTimeout(()=>t.classList.remove("animate"),400))}}),s&&f()},document.addEventListener("DOMContentLoaded",()=>{!function(){const e=localStorage.getItem("theme")||"dark",t=document.getElementById("themeToggle"),n=document.getElementById("themeIcon");function o(e){document.documentElement.setAttribute("data-theme",e),n.innerHTML="light"===e?'<path d="M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5,5-2.24,5-5-2.24-5-5-5Zm0,7c-1.1,0-2-.9-2-2s.9-2,2-2,2,.9,2,2-.9,2-2,2Zm4.95-6.95c-.59-.59-.59-1.54,0-2.12l1.41-1.41c.59-.59,1.54-.59,2.12,0,.59,.59,.59,1.54,0,2.12l-1.41,1.41c-.29,.29-.68,.44-1.06,.44s-.77-.15-1.06-.44ZM7.05,16.95c.59,.59,.59,1.54,0,2.12l-1.41,1.41c-.29,.29-.68,.44-1.06,.44s-.77-.15-1.06-.44c-.59-.59-.59-1.54,0-2.12l1.41-1.41c.59-.59,1.54-.59,2.12,0ZM3.51,5.64c-.59-.59-.59-1.54,0-2.12,.59-.59,1.54-.59,2.12,0l1.41,1.41c.59,.59,.59,1.54,0,2.12-.29,.29-.68,.44-1.06,.44s-.77-.15-1.06-.44l-1.41-1.41Zm16.97,12.73c.59,.59,.59,1.54,0,2.12-.29,.29-.68,.44-1.06,.44s-.77-.15-1.06-.44l-1.41-1.41c-.59-.59-.59-1.54,0-2.12,.59-.59,1.54-.59,2.12,0l1.41,1.41Zm3.51-6.36c0,.83-.67,1.5-1.5,1.5h-2c-.83,0-1.5-.67-1.5-1.5s.67-1.5,1.5-1.5h2c.83,0,1.5,.67,1.5,1.5ZM3.5,13.5H1.5c-.83,0-1.5-.67-1.5-1.5s.67-1.5,1.5-1.5H3.5c.83,0,1.5,.67,1.5,1.5s-.67,1.5-1.5,1.5ZM10.5,3.5V1.5c0-.83,.67-1.5,1.5-1.5s1.5,.67,1.5,1.5V3.5c0,.83-.67,1.5-1.5,1.5s-1.5-.67-1.5-1.5Zm3,17v2c0,.83-.67,1.5-1.5,1.5s-1.5-.67-1.5-1.5v-2c0-.83,.67-1.5,1.5-1.5s1.5,.67,1.5,1.5Z"/>':'<path d="M15,24a12.021,12.021,0,0,1-8.914-3.966,11.9,11.9,0,0,1-3.02-9.309A12.122,12.122,0,0,1,13.085.152a13.061,13.061,0,0,1,5.031.205,2.5,2.5,0,0,1,1.108,4.226c-4.56,4.166-4.164,10.644.807,14.41a2.5,2.5,0,0,1-.7,4.32A13.894,13.894,0,0,1,15,24Z"/>',localStorage.setItem("theme",e),Q()}o(e),t.addEventListener("click",()=>{o("dark"===document.documentElement.getAttribute("data-theme")?"light":"dark")});const a=document.getElementById("headerLogo");a&&a.addEventListener("click",()=>{const e=localStorage.getItem("selectedCountry")||"all";if("all"===e)window.location.href="/";else{const t=c(e);window.location.href=`/country/${t}`}})}(),h(),function(){const e=document.getElementById("dropdownButton"),t=document.getElementById("dropdownMenu");function n(){e.classList.remove("open","active"),t.classList.remove("open")}e.addEventListener("click",o=>{o.stopPropagation(),t.classList.contains("open")?n():(e.classList.add("open","active"),t.classList.add("open"))}),document.addEventListener("click",o=>{e.contains(o.target)||t.contains(o.target)||n()}),document.addEventListener("keydown",o=>{"Escape"===o.key&&t.classList.contains("open")&&(n(),e.focus())}),window.closeDropdown=n}(),function(){const e=document.getElementById("aiModal"),t=document.getElementById("modalClose"),n=document.getElementById("appInfoModal"),o=document.getElementById("appInfoModalClose"),a=document.getElementById("infoModal"),s=document.getElementById("infoModalClose"),i=document.getElementById("icmModal"),l=document.getElementById("icmModalClose");t.addEventListener("click",H),e.addEventListener("click",t=>{t.target===e&&H()}),o&&o.addEventListener("click",D),n&&n.addEventListener("click",e=>{e.target===n&&D()}),s.addEventListener("click",F),a.addEventListener("click",e=>{e.target===a&&F()}),l.addEventListener("click",W),i.addEventListener("click",e=>{e.target===i&&W()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&(e.classList.contains("active")&&H(),n&&n.classList.contains("active")&&D(),a.classList.contains("active")&&F(),i.classList.contains("active")&&W())})}(),function(){const e=document.getElementById("searchInput"),t=document.getElementById("searchClear");let n;e.addEventListener("focus",()=>{K&&ne({skipRender:!0})}),e.addEventListener("input",e=>{const o=e.target.value;K&&ne({skipRender:!0}),""!==o.trim()?t.classList.add("visible"):t.classList.remove("visible"),s&&""!==o.trim()&&(s=!1,document.getElementById("favoritesToggle").classList.remove("active")),n&&clearTimeout(n),n=setTimeout(()=>{q(l,o,!0),window.scrollTo(0,0)},300)}),t.addEventListener("click",()=>{K&&ne({skipRender:!0}),e.value="",t.classList.remove("visible"),q(l,""),window.scrollTo(0,0),e.focus()}),e.addEventListener("keydown",n=>{"Escape"===n.key&&""!==e.value&&(K&&ne({skipRender:!0}),e.value="",t.classList.remove("visible"),q(l,""))})}(),G(),y(),function(){const e=document.getElementById("hamburgerMenu"),t=document.getElementById("headerControls"),n=document.querySelector(".main-content");e&&e.addEventListener("click",()=>{t.classList.contains("show")?(t.classList.remove("show"),e.classList.remove("active"),e.textContent="‚ò∞",n&&n.classList.remove("menu-open")):(t.classList.add("show"),e.classList.add("active"),e.textContent="‚úï",n&&n.classList.add("menu-open"))})}(),Z(),function(){const e=document.getElementById("columnToggle");if(!e)return;const t=document.getElementById("spotsGrid"),n=document.getElementById("icon3Columns"),o=document.getElementById("icon2Columns"),a=window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),s=localStorage.getItem("threeColumns");let i=null===s||"true"===s;function l(e){e?(n.style.display="block",o.style.display="none"):(n.style.display="none",o.style.display="block")}a&&i&&(i=!1,localStorage.setItem("threeColumns","false")),i?t.classList.add("three-columns"):t.classList.remove("three-columns"),l(i),null===s&&localStorage.setItem("threeColumns",String(i)),e.addEventListener("click",()=>{K&&ne({skipRender:!0}),t.classList.toggle("three-columns");const e=t.classList.contains("three-columns");localStorage.setItem("threeColumns",String(e)),l(e)})}(),function(){const e=document.getElementById("mapToggle");e&&e.addEventListener("click",()=>{K?ne():te()})}(),window.addEventListener("popstate",()=>{if(u())s||(s=!0,localStorage.setItem("showingFavorites","true"),document.getElementById("favoritesToggle").classList.add("active"),f());else{s&&(s=!1,localStorage.setItem("showingFavorites","false"),document.getElementById("favoritesToggle").classList.remove("active"));const e=d();if(e){const t=m(e);t&&(localStorage.setItem("selectedCountry",t),p(t),q(t,"",!0))}else{const e=localStorage.getItem("selectedCountry")||"all";p(e),q(e,"",!0)}}}),function(){const e=document.getElementById("infoToggle");e&&e.addEventListener("click",()=>{N()})}(),_(),J()});
