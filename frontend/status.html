<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <title>Status - VARUN.SURF</title>
    <meta name="description" content="System status and uptime information for VARUN.SURF - kitesurfing weather forecast dashboard">
    <meta name="robots" content="noindex, nofollow">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cstyle%3Epath%7Bfill:%231a1a1a%7D@media(prefers-color-scheme:dark)%7Bpath%7Bfill:%23f5f5f5%7D%7D%3C/style%3E%3Cpath d='M8,13H0V11H8Zm12.915-1.894A5,5,0,1,0,12,8V9h2V8a3,3,0,1,1,3,3H10v2H20a2,2,0,1,1-2,2H16a4,4,0,1,0,4.915-3.894ZM11,16H0v2H11a2,2,0,1,1-2,2H7a4,4,0,1,0,4-4ZM11,4A4,4,0,0,0,3,4H5A2,2,0,1,1,7,6H0V8H7A4,4,0,0,0,11,4Z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="styles.css">
    <script
            defer
            data-website-id="dfid_yUtxeXdTh4uWWN5KSQ3qU"
            data-domain="varun.surf"
            src="https://datafa.st/js/script.js">
    </script>
</head>
<body>
    <!-- MAIN CONTENT -->
    <div class="main-content main-content-status">
        <div class="container">

        <main class="status-page">
            <div class="status-container">
                <!-- STATUS PAGE HEADER -->
                <div class="status-page-header">
                    <div class="status-page-header-content">
                        <h1 class="status-page-title"><span onclick="window.location.href='/'">VARUN.SURF</span></h1>
                    </div>
                </div>

                <h2>System Status</h2>

                <div class="status-card">
                    <div class="status-header">
                        <div class="status-indicator" id="status-indicator">
                            <span class="status-dot"></span>
                            <span class="status-text">Loading...</span>
                        </div>
                        <div class="status-time" id="last-updated">
                            Last updated: -
                        </div>
                    </div>
                </div>

                <div class="status-card">
                    <h3>Service Information</h3>
                    <div class="status-info-grid">
                        <div class="status-info-item">
                            <div class="status-info-label">Version</div>
                            <div class="status-info-value" id="version">-</div>
                        </div>
                        <div class="status-info-item">
                            <div class="status-info-label">Uptime</div>
                            <div class="status-info-value" id="uptime">-</div>
                        </div>
                        <div class="status-info-item">
                            <div class="status-info-label">Started</div>
                            <div class="status-info-value" id="start-time">-</div>
                        </div>
                        <div class="status-info-item">
                            <div class="status-info-label">Spots</div>
                            <div class="status-info-value" id="spots-count">-</div>
                        </div>
                    </div>
                </div>

                <div class="status-card">
                    <h3>API Endpoints</h3>
                    <div class="status-endpoints">
                        <div class="status-endpoint" data-endpoint="/api/v1/health">
                            <div class="status-endpoint-info">
                                <span class="status-endpoint-dot"></span>
                                <span class="status-endpoint-name">/api/v1/health</span>
                            </div>
                            <span class="status-endpoint-status">checking...</span>
                        </div>
                        <div class="status-endpoint" data-endpoint="/api/v1/status">
                            <div class="status-endpoint-info">
                                <span class="status-endpoint-dot"></span>
                                <span class="status-endpoint-name">/api/v1/status</span>
                            </div>
                            <span class="status-endpoint-status">checking...</span>
                        </div>
                        <div class="status-endpoint" data-endpoint="/api/v1/spots">
                            <div class="status-endpoint-info">
                                <span class="status-endpoint-dot"></span>
                                <span class="status-endpoint-name">/api/v1/spots</span>
                            </div>
                            <span class="status-endpoint-status">checking...</span>
                        </div>
                    </div>
                </div>

                <div class="status-actions">
                    <button id="refresh-status" class="btn btn-primary">
                        Refresh Status
                    </button>
                    <a href="/" class="btn btn-secondary">
                        Back to Dashboard
                    </a>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <p class="footer-disclaimer">weather forecast and real-time wind conditions dashboard for kitesurfers</p>
                <p class="footer-link">&copy; 2025 <a href="https://varun.surf">varun.surf</a> â€¢ <a
                        href="https://github.com/pwittchen/varun.surf">open-source</a> â€¢ made in ðŸ‡µðŸ‡± by <a
                        href="https://wittchen.io" target="_blank" class="footer-external-link">Piotr Wittchen</a> â€¢ <a href="https://github.com/pwittchen/varun.surf/releases">changelog</a> â€¢ <a href="/status">status</a></p>
            </div>
        </footer>
    </div>

    <script>
        // Set initial theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Status page functionality
        async function fetchStatus() {
            try {
                const response = await fetch('/api/v1/status');
                if (!response.ok) throw new Error('Failed to fetch status');

                const data = await response.json();

                // Update status indicator
                const indicator = document.getElementById('status-indicator');
                const statusDot = indicator.querySelector('.status-dot');
                const statusText = indicator.querySelector('.status-text');

                if (data.status === 'UP') {
                    statusDot.className = 'status-dot status-dot-up';
                    statusText.textContent = 'All Systems Operational';
                } else {
                    statusDot.className = 'status-dot status-dot-down';
                    statusText.textContent = 'System Issues Detected';
                }

                // Update service information
                document.getElementById('version').textContent = data.version || 'unknown';
                document.getElementById('uptime').textContent = data.uptime || '-';
                document.getElementById('spots-count').textContent = data.spotsCount || '0';

                if (data.startTime) {
                    const startDate = new Date(data.startTime);
                    document.getElementById('start-time').textContent = startDate.toLocaleString();
                }

                // Update last updated time
                document.getElementById('last-updated').textContent =
                    'Last updated: ' + new Date().toLocaleTimeString();

            } catch (error) {
                console.error('Error fetching status:', error);
                const indicator = document.getElementById('status-indicator');
                const statusDot = indicator.querySelector('.status-dot');
                const statusText = indicator.querySelector('.status-text');
                statusDot.className = 'status-dot status-dot-down';
                statusText.textContent = 'Unable to Connect';
            }
        }

        async function checkEndpoint(endpoint) {
            const endpointEl = document.querySelector(`[data-endpoint="${endpoint}"]`);
            const statusSpan = endpointEl.querySelector('.status-endpoint-status');
            const dotEl = endpointEl.querySelector('.status-endpoint-dot');

            try {
                const response = await fetch(endpoint);
                if (response.ok) {
                    statusSpan.textContent = 'operational';
                    dotEl.className = 'status-endpoint-dot status-endpoint-dot-up';
                } else {
                    statusSpan.textContent = `error (${response.status})`;
                    dotEl.className = 'status-endpoint-dot status-endpoint-dot-down';
                }
            } catch (error) {
                statusSpan.textContent = 'unreachable';
                dotEl.className = 'status-endpoint-dot status-endpoint-dot-down';
            }
        }

        async function checkAllEndpoints() {
            const endpoints = ['/api/v1/health', '/api/v1/status', '/api/v1/spots'];
            await Promise.all(endpoints.map(checkEndpoint));
        }

        async function refreshStatus() {
            await fetchStatus();
            await checkAllEndpoints();
        }

        // Initial load
        refreshStatus();

        // Auto-refresh every 30 seconds
        setInterval(refreshStatus, 30000);

        // Manual refresh button
        document.getElementById('refresh-status').addEventListener('click', refreshStatus);
    </script>
</body>
</html>