<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VARUN.SURF</title>
    <link rel="icon" type="image/svg+xml"
          href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3e%3cdefs%3e%3clinearGradient id='ocean' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3e%3cstop offset='0%25' style='stop-color:%231e40af;stop-opacity:1' /%3e%3cstop offset='50%25' style='stop-color:%234a9eff;stop-opacity:1' /%3e%3cstop offset='100%25' style='stop-color:%2306b6d4;stop-opacity:1' /%3e%3c/linearGradient%3e%3clinearGradient id='wave' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3e%3cstop offset='0%25' style='stop-color:%23ffffff;stop-opacity:0.9' /%3e%3cstop offset='100%25' style='stop-color:%23f0f9ff;stop-opacity:0.7' /%3e%3c/linearGradient%3e%3c/defs%3e%3crect width='100' height='100' rx='20' fill='url(%23ocean)'/%3e%3cpath d='M0 60 Q15 45 30 60 T60 55 T90 60 T120 55 L120 100 L0 100 Z' fill='url(%23wave)' opacity='0.8'/%3e%3cpath d='M0 70 Q20 55 40 70 T80 65 T120 70 L120 100 L0 100 Z' fill='url(%23wave)' opacity='0.6'/%3e%3cpath d='M0 80 Q25 65 50 80 T100 75 T150 80 L150 100 L0 100 Z' fill='url(%23wave)' opacity='0.4'/%3e%3ccircle cx='75' cy='25' r='8' fill='%23fbbf24' opacity='0.9'/%3e%3cpath d='M70 30 Q75 35 80 30' fill='none' stroke='%23fbbf24' stroke-width='1' opacity='0.6'/%3e%3cpath d='M10 40 Q15 35 20 40 Q25 45 30 40' fill='none' stroke='%23ffffff' stroke-width='1.5' opacity='0.5'/%3e%3cpath d='M40 35 Q45 30 50 35 Q55 40 60 35' fill='none' stroke='%23ffffff' stroke-width='1.5' opacity='0.5'/%3e%3c/svg%3e">
    <style>
        :root {
            /* Dark theme variables */
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #262626;
            --text-primary: #e8e8e8;
            --text-secondary: #9ca3af;
            --text-tertiary: #5e6165;
            --border-primary: #262626;
            --border-secondary: #333;
            --border-hover: #404040;
            --accent-primary: #4a9eff;
            --accent-secondary: #216ebb;
            --gradient-button: linear-gradient(145deg, #1d1d1d, #2c2c2c);
            --gradient-button-hover: linear-gradient(145deg, #2c2c2c, #3d3d3d);
            --gradient-active: linear-gradient(145deg, #00397b, #1663b0);
            --gradient-header: linear-gradient(145deg, #0854ab, #216ebb);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, .6);
            --error-bg: linear-gradient(145deg, #4b0404, #550303);
            --error-border: #840808;
            --error-text: #fca5a5;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        [data-theme="light"] {
            /* Light theme variables */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-tertiary: #adb5bd;
            --border-primary: #dee2e6;
            --border-secondary: #ced4da;
            --border-hover: #adb5bd;
            --accent-primary: #0d6efd;
            --accent-secondary: #0a58ca;
            --gradient-button: linear-gradient(145deg, #f8f9fa, #e9ecef);
            --gradient-button-hover: linear-gradient(145deg, #e9ecef, #dee2e6);
            --gradient-active: linear-gradient(145deg, #0d6efd, #0a58ca);
            --gradient-header: linear-gradient(145deg, #0d6efd, #0a58ca);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, .1);
            --error-bg: linear-gradient(145deg, #f8d7da, #f5c6cb);
            --error-border: #f1aeb5;
            --error-text: #721c24;
            --success-color: #198754;
            --warning-color: #fd7e14;
            --danger-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* FIXED HEADER STYLES */
        .fixed-header {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            z-index: 9999 !important;
            background: rgba(15, 15, 15, 0.7) !important;
            backdrop-filter: blur(5px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(5px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
            padding: 20px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
        }

        [data-theme="light"] .fixed-header {
            background: rgba(255, 255, 255, 0.7) !important;
            border-bottom: 1px solid rgba(0, 0, 0, 0.2) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15) !important;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .header-controls {
            position: absolute;
            top: 5px;
            right: 0;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .spot-counter {
            background: var(--gradient-button);
            border: 1px solid var(--border-secondary);
            color: var(--text-secondary);
            padding: 12px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: center;
            user-select: none;
        }

        .spot-counter-number {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .main-content {
            margin-top: 120px;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-title {
            font-size: 2.8rem;
            font-weight: 100;
            color: #fff;
            margin-bottom: 8px;
            letter-spacing: -.02em;
            text-align: left;
        }

        [data-theme="light"] .header-title {
            color: #000;
        }

        .theme-toggle {
            background: var(--gradient-button);
            border: 1px solid var(--border-secondary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 10px;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: var(--gradient-button-hover);
            border-color: var(--border-hover);
        }

        .theme-toggle.active {
            background: var(--gradient-active);
            border-color: var(--accent-primary);
            color: #fff;
            box-shadow: 0 4px 12px rgba(74, 158, 255, .4);
        }

        .theme-icon {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .dropdown-container {
            position: relative;
            width: 220px;
        }

        .search-container {
            position: relative;
            width: 220px;
        }

        .search-input {
            background: var(--gradient-button);
            border: 1px solid var(--border-secondary);
            color: var(--text-primary);
            padding: 12px 32px 12px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 4px 12px rgba(74, 158, 255, .2);
        }

        .search-clear {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            padding: 4px;
            display: none;
            transition: color 0.2s ease;
        }

        .search-clear:hover {
            color: var(--text-primary);
        }

        .search-clear.visible {
            display: block;
        }

        .dropdown-button {
            background: var(--gradient-button);
            border: 1px solid var(--border-secondary);
            color: #e0e0e0;
            padding: 8px 32px 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: .9rem;
            font-weight: 500;
            width: 220px;
            text-align: left;
            transition: all .3s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        [data-theme="light"] .dropdown-button {
            color: #212529;
        }

        .dropdown-button:hover {
            background: var(--gradient-button-hover);
            border-color: var(--border-hover);
        }

        .dropdown-button.active {
            background: var(--gradient-active);
            border-color: var(--accent-primary);
            color: #fff;
            box-shadow: 0 4px 12px rgba(74, 158, 255, .4);
        }

        .dropdown-arrow {
            font-size: .8rem;
            transition: transform .3s ease;
            color: #9ca3af;
        }

        [data-theme="light"] .dropdown-arrow {
            color: #6c757d;
        }

        .dropdown-button.active .dropdown-arrow {
            color: #fff;
        }

        .dropdown-button.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            margin-top: 4px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all .3s ease;
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(10px);
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-menu.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: all .2s ease;
            border-bottom: 1px solid var(--border-primary);
            font-size: .9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e8e8e8;
        }

        [data-theme="light"] .dropdown-option {
            color: #212529;
        }

        .dropdown-option:last-child {
            border-bottom: none;
        }

        .dropdown-option:hover {
            background: var(--bg-tertiary);
            color: #fff;
        }

        [data-theme="light"] .dropdown-option:hover {
            color: #000;
        }

        .dropdown-option.selected {
            background: var(--gradient-active);
            color: #fff;
        }

        .dropdown-option:first-child {
            border-radius: 11px 11px 0 0;
        }

        .dropdown-option:last-child {
            border-radius: 0 0 11px 11px;
        }

        .error-message {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(220, 38, 38, .2);
        }

        .error-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            display: block;
        }

        .error-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        [data-theme="light"] .error-title {
            color: #721c24;
        }

        .error-description {
            color: var(--error-text);
            font-size: .9rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .loading-message {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            text-align: center;
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-primary);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: #9ca3af;
            font-size: 1rem;
            vertical-align: middle;
        }

        [data-theme="light"] .loading-text {
            color: #6c757d;
        }

        .spots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
        }

        .spot-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            box-shadow: none;
            border: 1px solid var(--border-primary);
            transition: border-color .2s ease;
            position: relative;
        }

        .spot-card:hover {
            transform: none;
            box-shadow: none;
            border-color: var(--border-secondary);
        }

        .spot-card.dragging {
            opacity: 0.3;
            cursor: grabbing;
        }

        .drag-ghost {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            opacity: 0.8;
            transform: scale(1.05);
            box-shadow: 0 12px 48px rgba(0, 0, 0, .5);
            cursor: grabbing;
        }

        .drag-handle {
            position: absolute;
            top: 18px;
            left: 28px;
            font-size: 1.2rem;
            cursor: grab;
            color: var(--text-secondary);
            transition: color 0.2s ease;
            user-select: none;
            z-index: 10;
            margin-bottom: 20px;
            padding-bottom: 41px;
            border-bottom: 1px solid var(--border-primary);
        }

        .drag-handle:hover {
            color: var(--text-primary);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .favorite-icon {
            position: absolute;
            top: 21px;
            right: 157px;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            user-select: none;
            z-index: 10;
            filter: grayscale(100%);
        }

        .favorite-icon:hover {
            filter: grayscale(0%);
        }

        .favorite-icon.favorited {
            color: #fbbf24;
            filter: grayscale(0%);
        }

        @keyframes favorite-pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.3);
            }
            100% {
                transform: scale(1);
            }
        }

        .favorite-icon.animate {
            animation: favorite-pulse 0.4s ease-out;
        }

        .spot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-left: 22px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            padding-left: 5px;
            border-bottom: 1px solid var(--border-primary);
        }

        .spot-title {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .spot-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .spot-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
        }

        [data-theme="light"] .spot-name {
            color: #000;
        }

        .last-updated {
            font-size: .75rem;
            color: #5e6165;
            font-weight: 400;
        }

        [data-theme="light"] .last-updated {
            color: #adb5bd;
        }

        .country-tag {
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: .75rem;
            color: #9ca3af;
            border: none;
            font-weight: 500;
        }

        [data-theme="light"] .country-tag {
            color: #6c757d;
        }

        .external-links {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .external-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: transparent;
            color: #9ca3af;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: .75rem;
            font-weight: 500;
            border: 1px solid var(--border-secondary);
            transition: all .15s ease;
            cursor: pointer;
        }

        [data-theme="light"] .external-link {
            color: #6c757d;
        }

        .external-link:hover {
            background: var(--bg-tertiary);
            color: #fff;
            border-color: var(--border-hover);
        }

        [data-theme="light"] .external-link:hover {
            color: #000;
        }

        .external-link::after {
            content: "↗";
            font-size: .7rem;
            opacity: .6;
        }

        .external-link.location-link::after {
            content: "⚲";
            font-size: .8rem;
            opacity: 1;
        }

        .external-link.webcam-link::after {
            content: "⊙";
            font-size: .8rem;
            opacity: 1;
        }

        .external-link.ai-link {
            border: 1px solid #1f7987;
        }

        .external-link.ai-link::after {
            content: "⟡";
            font-size: .8rem;
            opacity: 1;
        }

        .external-link.info-link::after {
            content: "ⓘ";
            font-size: .8rem;
            opacity: 1;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .8);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn .3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .5);
            animation: modalSlideIn .3s ease;
        }

        .modal-header {
            background: var(--gradient-header);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background .2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, .1);
        }

        .modal-content {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(80vh - 80px);
        }

        .ai-analysis {
            color: #e8e8e8;
            line-height: 1.6;
            font-size: .95rem;
        }

        [data-theme="light"] .ai-analysis {
            color: #212529;
        }

        .ai-analysis h3 {
            color: #4a9eff;
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        [data-theme="light"] .ai-analysis h3 {
            color: #0d6efd;
        }

        .ai-analysis p {
            margin-bottom: 16px;
        }

        .ai-analysis ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .ai-analysis li {
            margin-bottom: 8px;
        }

        .ai-highlight {
            background: rgba(74, 158, 255, .1);
            color: #4a9eff;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        [data-theme="light"] .ai-highlight {
            color: #0d6efd;
        }

        .spot-info {
            color: #e8e8e8;
            line-height: 1.6;
            font-size: .95rem;
        }

        [data-theme="light"] .spot-info {
            color: #212529;
        }

        .spot-info h3 {
            color: #4a9eff;
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        [data-theme="light"] .spot-info h3 {
            color: #0d6efd;
        }

        .spot-info p {
            margin-bottom: 16px;
        }

        .spot-info .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .info-item {
            background: var(--bg-tertiary);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-primary);
        }

        .info-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .weather-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
        }

        .weather-table th {
            background: var(--bg-tertiary);
            color: #fff;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-bottom: none;
            font-size: .8rem;
            text-transform: uppercase;
            letter-spacing: .05em;
        }

        [data-theme="light"] .weather-table th {
            color: #000;
        }

        .weather-table th:first-child {
            text-align: left;
        }

        .weather-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-primary);
            font-size: .875rem;
            color: #e8e8e8;
        }

        [data-theme="light"] .weather-table td {
            color: #212529;
        }

        .weather-table td:first-child {
            text-align: left;
        }

        .weather-table tbody tr.weak-wind td:nth-child(2),
        .weather-table tbody tr.weak-wind td:nth-child(3),
        .weather-table tbody tr.weak-wind td:nth-child(4) {
            color: #6b7280 !important;
        }

        .weather-table tbody tr.moderate-wind td:nth-child(2),
        .weather-table tbody tr.moderate-wind td:nth-child(3),
        .weather-table tbody tr.moderate-wind td:nth-child(4) {
            color: #22c55e !important;
        }

        .weather-table tbody tr.strong-wind td:nth-child(2),
        .weather-table tbody tr.strong-wind td:nth-child(3),
        .weather-table tbody tr.strong-wind td:nth-child(4) {
            color: #f59e0b !important;
        }

        .weather-table tbody tr.extreme-wind td:nth-child(2),
        .weather-table tbody tr.extreme-wind td:nth-child(3),
        .weather-table tbody tr.extreme-wind td:nth-child(4) {
            color: #ef4444 !important;
        }

        .weather-table tbody td.wind-weak {
            color: #6b7280 !important;
        }

        .weather-table tbody td.wind-moderate {
            color: #22c55e !important;
            font-weight: 600;
        }

        .weather-table tbody td.wind-strong {
            color: #f59e0b !important;
            font-weight: 600;
        }

        .weather-table tbody td.wind-extreme {
            color: #ef4444 !important;
            font-weight: 600;
        }

        .weather-table tbody td.temp-positive {
            color: #f97316 !important;
        }

        .weather-table tbody td.temp-negative {
            color: #06b6d4 !important;
        }

        .weather-table tbody td.precipitation {
            color: #3b82f6 !important;
        }

        .weather-table tbody td.precipitation-none {
            color: #6b7280 !important;
        }

        .weather-table tbody td.wave-small {
            color: #22c55e !important;
        }

        .weather-table tbody td.wave-moderate {
            color: #f59e0b !important;
            font-weight: 600;
        }

        .weather-table tbody td.wave-large {
            color: #ef4444 !important;
            font-weight: 600;
        }

        .weather-table tr.weak-wind {
            background: transparent;
            color: var(--text-secondary);
        }

        .weather-table tr.moderate-wind {
            background: rgba(34, 197, 94, .1);
            color: var(--success-color);
        }

        .weather-table tr.strong-wind {
            background: rgba(245, 158, 11, .1);
            color: var(--warning-color);
        }

        .weather-table tr.extreme-wind {
            background: rgba(239, 68, 68, .1);
            color: var(--danger-color);
        }

        .wind-arrow {
            display: inline-block;
            font-size: 1.2rem;
            transition: transform .3s ease;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            position: relative;
            animation: pulse-glow 2s ease-in-out infinite;
            margin-left: 8px;
        }

        .live-dot::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--success-color);
            border-radius: 50%;
            opacity: .4;
            animation: pulse-ring 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: .8;
                transform: scale(1.1);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: .4;
            }
            50% {
                transform: scale(1.5);
                opacity: .2;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .hamburger-menu {
            display: none;
            background: var(--gradient-button);
            border: 1px solid var(--border-secondary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            position: absolute;
            top: 0;
            right: 0;
        }

        .hamburger-menu:hover {
            background: var(--gradient-button-hover);
            border-color: var(--border-hover);
        }

        .hamburger-menu.active {
            background: var(--gradient-active);
            border-color: var(--accent-primary);
            color: #fff;
        }

        @media (max-width: 1150px) {
            .spots-grid {
                grid-template-columns: 1fr;
            }

            .weather-table {
                font-size: .85rem;
            }

            .weather-table td, .weather-table th {
                padding: 8px 4px;
            }

            .error-message {
                padding: 20px;
            }

            .error-title {
                font-size: 1.1rem;
            }

            .error-description {
                font-size: .85rem;
            }

            .fixed-header {
                padding: 15px 20px !important;
            }

            .header-content {
                text-align: center;
            }

            .header-title {
                text-align: center;
                margin-top: 0px;
                font-size: 2.2rem;
            }

            .hamburger-menu {
                display: block;
            }

            .header-controls {
                position: static;
                flex-direction: column;
                align-items: center;
                gap: 12px;
                margin-bottom: 15px;
                width: 100%;
                justify-content: center;
                max-height: 0;
                overflow: visible;
                opacity: 0;
                transition: max-height 0.3s ease, opacity 0.3s ease, margin-bottom 0.3s ease;
                pointer-events: none;
            }

            .header-controls.show {
                max-height: 500px;
                opacity: 1;
                margin-bottom: 15px;
                pointer-events: auto;
            }

            .header-controls > * {
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .header-controls.show > * {
                opacity: 1;
            }

            .theme-toggle {
                width: 100%;
                max-width: 300px;
            }

            .search-container {
                width: 100%;
                max-width: 300px;
            }

            .dropdown-container {
                width: 100%;
                max-width: 300px;
            }

            .dropdown-button {
                width: 100%;
            }

            .spot-counter {
                width: 100%;
                max-width: 300px;
            }

            .main-content {
                margin-top: 165px;
            }

            .main-content.menu-open {
                margin-top: 380px;
            }

            .info-grid {
                grid-template-columns: 1fr !important;
            }

            .drag-handle {
                display: none;
            }

            .spot-header {
                margin-left: 0;
            }
        }

        .footer {
            margin-top: 60px;
            padding: 30px 0;
            border-top: 1px solid var(--border-primary);
            text-align: center;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-content p {
            color: #9ca3af;
            font-size: .875rem;
            margin-bottom: 8px;
        }

        [data-theme="light"] .footer-content p {
            color: #6c757d;
        }

        .footer-content p:last-child {
            margin-bottom: 0;
        }

        .footer-disclaimer {
            font-size: .75rem;
            opacity: .8;
        }

        .footer-link {
            font-size: .75rem;
            margin-top: 12px;
        }

        .footer-disclaimer a, .footer-link a {
            color: #4a9eff;
            text-decoration: none;
            transition: color .2s ease;
        }

        .footer-disclaimer a:hover, .footer-link a:hover {
            color: #fff;
            text-decoration: underline;
        }

        [data-theme="light"] .footer-disclaimer a, [data-theme="light"] .footer-link a {
            color: #0d6efd;
        }

        [data-theme="light"] .footer-disclaimer a:hover, [data-theme="light"] .footer-link a:hover {
            color: #000;
        }

        /* Kite Size Calculator Styles */
        .calc-input-group {
            margin-bottom: 20px;
        }

        .calc-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .calc-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .calc-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
        }

        .calc-select {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calc-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
        }

        .calc-button {
            width: 100%;
            background: var(--gradient-active);
            border: 1px solid var(--accent-primary);
            color: #fff;
            padding: 14px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .calc-button:hover {
            background: var(--gradient-header);
            box-shadow: 0 4px 12px rgba(74, 158, 255, .4);
        }

        .calc-result {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .calc-result.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .calc-result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-primary);
            margin-bottom: 16px;
        }

        .calc-result-item {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-primary);
        }

        .calc-result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .calc-result-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .calc-result-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calc-disclaimer {
            margin-top: 16px;
            padding: 12px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .calc-warning {
            display: none;
            background: #681414;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
<!-- FIXED HEADER -->
<div class="fixed-header">
    <div class="header-content">
        <button class="hamburger-menu" id="hamburgerMenu">☰</button>
        <div class="header-controls" id="headerControls">
            <button class="theme-toggle" id="themeToggle">
                <span class="theme-icon" id="themeIcon">🌙</span>
                <span id="themeText">Dark</span>
            </button>
            <button class="theme-toggle" id="favoritesToggle" title="View favorites">
                ⭐
            </button>
            <button class="theme-toggle" id="kiteSizeToggle" title="Kite/Board Size Calculator">
                🧮
            </button>
            <div class="search-container">
                <input type="text"
                       class="search-input"
                       id="searchInput"
                       placeholder="Search spots..."
                       autocomplete="off">
                <button class="search-clear" id="searchClear">✕</button>
            </div>
            <div class="dropdown-container">
                <button class="dropdown-button" id="dropdownButton">
                    <span id="selectedCountry">🌎 All</span>
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <!-- Dropdown options will be populated dynamically -->
                </div>
            </div>
            <div class="spot-counter" id="spotCounter">
                <span class="spot-counter-number" id="spotCounterNumber">0</span>
                <span>spots</span>
            </div>
            <div class="spot-counter">
                <span>GFS 13 KM</span>
            </div>
        </div>
        <h1 class="header-title">VARUN.SURF</h1>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
    <div class="container">
        <div class="spots-grid" id="spotsGrid">
            <!-- Spots will be generated by JavaScript -->
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-disclaimer">weather forecast and real-time wind conditions dashboard for kitesurfers</p>
            <p class="footer-link">&copy; 2025 <a href="https://varun.surf">varun.surf</a> • <a
                    href="https://github.com/pwittchen/varun.surf">open-source</a> • made in 🇵🇱 by <a
                    href="https://wittchen.io" target="_blank" class="footer-external-link">Piotr Wittchen</a> • v.
                0.0.1</p>
        </div>
    </footer>
</div>

<!-- Modal for AI Analysis -->
<div class="modal-overlay" id="aiModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">
                <span>⟡</span>
                <span id="modalSpotName">AI</span>
            </div>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="ai-analysis" id="aiAnalysisContent">
                <!-- AI analysis content will be inserted here -->
            </div>
        </div>
    </div>
</div>

<!-- Modal for Spot Info -->
<div class="modal-overlay" id="infoModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">
                <span>ⓘ</span>
                <span id="infoModalSpotName">Spot Information</span>
            </div>
            <button class="modal-close" id="infoModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="spot-info" id="spotInfoContent">
                <!-- Spot information content will be inserted here -->
            </div>
        </div>
    </div>
</div>

<!-- Modal for Kite Size Calculator -->
<div class="modal-overlay" id="kiteSizeModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">
                <span>🧮</span>
                <span>Kite & Board Size Calculator</span>
            </div>
            <button class="modal-close" id="kiteSizeModalClose">&times;</button>
        </div>
        <div class="modal-content">
            <div class="calc-input-group">
                <label class="calc-label" for="windSpeed">Wind Speed (knots)</label>
                <input type="number" id="windSpeed" class="calc-input" placeholder="Enter wind speed in knots" min="5"
                       max="50" step="1">
            </div>

            <div class="calc-input-group">
                <label class="calc-label" for="riderWeight">Rider Weight (kg)</label>
                <input type="number" id="riderWeight" class="calc-input" placeholder="Enter your weight in kg" min="40"
                       max="150" step="1">
            </div>

            <div class="calc-input-group">
                <label class="calc-label" for="skillLevel">Skill Level & Conditions</label>
                <select id="skillLevel" class="calc-select">
                    <option value="">Select skill level & conditions</option>
                    <option value="beginner-flat">Beginner - Flat Water</option>
                    <option value="beginner-small">Beginner - Small Waves</option>
                    <option value="intermediate-flat">Intermediate - Flat Water</option>
                    <option value="intermediate-medium">Intermediate - Medium Waves</option>
                    <option value="advanced-flat">Advanced - Flat Water</option>
                    <option value="advanced-medium">Advanced - Medium Waves</option>
                    <option value="advanced-large">Advanced - Large Waves</option>
                </select>
            </div>

            <button class="calc-button" id="calculateBtn">Calculate</button>

            <div class="calc-warning" id="calcWarning"></div>

            <div class="calc-result" id="calcResult">
                <div class="calc-result-title">Recommended Equipment</div>
                <div class="calc-result-item">
                    <div class="calc-result-label">Kite Size</div>
                    <div class="calc-result-value" id="kiteSize">-</div>
                </div>
                <div class="calc-result-item">
                    <div class="calc-result-label">Board Size</div>
                    <div class="calc-result-value" id="boardSize">-</div>
                </div>
                <div class="calc-disclaimer">
                    ⚠️ These are general recommendations. Actual equipment choice may vary based on specific kite model,
                    board type, and personal preference. Always consult with experienced riders or instructors for your
                    local conditions.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let globalWeatherData = [];
    let availableCountries = new Set();
    let currentSearchQuery = '';
    let showingFavorites = false;

    // Configuration
    const API_ENDPOINT = '/api/v1/spots';

    // Favorites management
    function getFavorites() {
        const favorites = localStorage.getItem('favoriteSpots');
        return favorites ? JSON.parse(favorites) : [];
    }

    function saveFavorites(favorites) {
        localStorage.setItem('favoriteSpots', JSON.stringify(favorites));
    }

    function isFavorite(spotName) {
        const favorites = getFavorites();
        return favorites.includes(spotName);
    }

    function toggleFavorite(spotName) {
        let favorites = getFavorites();
        const index = favorites.indexOf(spotName);

        if (index > -1) {
            // Remove from favorites
            favorites.splice(index, 1);
        } else {
            // Add to favorites
            favorites.push(spotName);
        }

        saveFavorites(favorites);

        // Update all instances of this spot's favorite icon
        const allFavoriteIcons = document.querySelectorAll('.favorite-icon');
        allFavoriteIcons.forEach(icon => {
            const card = icon.closest('.spot-card');
            if (card) {
                const spotNameElement = card.querySelector('.spot-name');
                if (spotNameElement && spotNameElement.textContent === spotName) {
                    if (index > -1) {
                        icon.classList.remove('favorited');
                        icon.title = 'Add to favorites';
                    } else {
                        icon.classList.add('favorited');
                        icon.title = 'Remove from favorites';
                    }

                    // Add animation
                    icon.classList.add('animate');
                    setTimeout(() => icon.classList.remove('animate'), 400);
                }
            }
        });

        // If showing favorites, re-render to reflect changes
        if (showingFavorites) {
            renderFavorites();
        }
    }

    // Theme functionality
    function initTheme() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');

        function updateTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            if (theme === 'light') {
                themeIcon.textContent = '☀️';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '🌙';
                themeText.textContent = 'Dark';
            }
            localStorage.setItem('theme', theme);
        }

        // Set initial theme
        updateTheme(savedTheme);

        // Theme toggle event
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            updateTheme(newTheme);
        });
    }

    async function fetchWeatherData() {
        try {
            const response = await fetch(API_ENDPOINT, {cache: 'no-store'});

            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }

            const data = await response.json();

            if (!Array.isArray(data)) {
                throw new Error('Invalid data format: Expected array of spots');
            }

            return data;
        } catch (error) {
            console.error('Error fetching weather data:', error);
            throw error;
        }
    }

    function showLoadingMessage() {
        const spotsGrid = document.getElementById('spotsGrid');
        spotsGrid.innerHTML = `
                <div class="loading-message">
                    <div class="loading-spinner"></div>
                    <span class="loading-text">Loading weather data...</span>
                </div>
            `;
    }

    function showErrorMessage(error) {
        const spotsGrid = document.getElementById('spotsGrid');

        let errorTitle = 'Failed to Load Weather Data';
        let errorMessage = 'Unable to fetch the latest weather information from the server.';

        if (error.message.includes('HTTP Error: 404')) {
            errorTitle = 'Data Source Not Found';
            errorMessage = 'The weather data endpoint is not available. Please check if the server is running.';
        } else if (error.message.includes('HTTP Error: 500')) {
            errorTitle = 'Server Error';
            errorMessage = 'The weather service is experiencing technical difficulties. Please try again later.';
        } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
            errorTitle = 'Connection Error';
            errorMessage = 'Unable to connect to the weather service. Please check your internet connection and ensure the server is running.';
        } else if (error.message.includes('JSON') || error.message.includes('Invalid data format')) {
            errorTitle = 'Data Format Error';
            errorMessage = 'The weather data received is corrupted or in an unexpected format.';
        }

        spotsGrid.innerHTML = `
                <div class="error-message">
                    <span class="error-icon">⚠️</span>
                    <div class="error-title">${errorTitle}</div>
                    <div class="error-description">
                        ${errorMessage}<br/>
                        Please refresh the page to try again.
                    </div>
                </div>
            `;
    }

    function getWindArrow(direction) {
        const arrows = {
            'N': '↓',
            'NE': '↙',
            'E': '←',
            'SE': '↖',
            'S': '↑',
            'SW': '↗',
            'W': '→',
            'NW': '↘'
        };
        return arrows[direction] || '•';
    }

    function populateCountryDropdown(data) {
        const dropdownMenu = document.getElementById('dropdownMenu');
        const selectedCountry = document.getElementById('selectedCountry');
        availableCountries.clear();

        // Collect all unique countries from the data
        data.forEach(spot => {
            if (spot.country) {
                availableCountries.add(spot.country);
            }
        });

        // Sort countries alphabetically
        const sortedCountries = Array.from(availableCountries).sort();

        // Get saved country from localStorage
        const savedCountry = localStorage.getItem('selectedCountry') || 'all';

        // Build dropdown HTML
        let dropdownHTML = `<div class="dropdown-option ${savedCountry === 'all' ? 'selected' : ''}" data-country="all">🌎 All</div>`;

        sortedCountries.forEach(country => {
            const countryFlag = getCountryFlag(country);
            const isSelected = savedCountry === country ? 'selected' : '';
            dropdownHTML += `<div class="dropdown-option ${isSelected}" data-country="${country}">${countryFlag} ${country.toUpperCase()}</div>`;
        });

        dropdownMenu.innerHTML = dropdownHTML;

        // Update the selected country text in the button
        if (savedCountry !== 'all') {
            const countryFlag = getCountryFlag(savedCountry);
            selectedCountry.textContent = `${countryFlag} ${savedCountry.toUpperCase()}`;
        } else {
            selectedCountry.textContent = '🌎 All';
        }

        // Re-attach event listeners for the new dropdown options
        setupDropdownEvents();
    }

    function getCountryFlag(country) {
        const flags = {
            'Poland': '🇵🇱',
            'Czechia': '🇨🇿',
            'Austria': '🇦🇹',
            'Belgium': '🇧🇪',
            'Switzerland': '🇨🇭',
            'Latvia': '🇱🇻',
            'Lithuania': '🇱🇹',
            'Estonia': '🇪🇪',
            'Denmark': '🇩🇰',
            'Sweden': '🇸🇪',
            'Norway': '🇳🇴',
            'Iceland': '🇮🇸',
            'Spain': '🇪🇸',
            'Portugal': '🇵🇹',
            'Italy': '🇮🇹',
            'Greece': '🇬🇷',
            'France': '🇫🇷',
            'Germany': '🇩🇪',
            'Netherlands': '🇳🇱',
            'Croatia': '🇭🇷',
            'Ireland': '🇮🇪',
            'UK': '🇬🇧',
            'Turkey': '🇹🇷',
            'Morocco': '🇲🇦',
            'Egypt': '🇪🇬',
            'Cape Verde': '🇨🇻',
            'Mauritius': '🇲🇺',
            'Brazil': '🇧🇷',
            'Peru': '🇵🇪',
            'Chile': '🇨🇱',
            'USA': '🇺🇸'
        };
        return flags[country] || '🏴';
    }

    function openAIModal(spotName) {
        const spot = globalWeatherData.find(spot => spot.name === spotName);
        if (!spot || !spot.aiAnalysis) return;

        const modal = document.getElementById('aiModal');
        const modalSpotName = document.getElementById('modalSpotName');
        const aiAnalysisContent = document.getElementById('aiAnalysisContent');

        modalSpotName.textContent = `AI Analysis - ${spotName}`;
        aiAnalysisContent.innerHTML = spot.aiAnalysis.trim();

        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function openInfoModal(spotName) {
        const spot = globalWeatherData.find(spot => spot.name === spotName);
        if (!spot || !spot.spotInfo) return;

        const modal = document.getElementById('infoModal');
        const modalSpotName = document.getElementById('infoModalSpotName');
        const spotInfoContent = document.getElementById('spotInfoContent');

        modalSpotName.textContent = `${spotName}`;

        const info = spot.spotInfo;
        spotInfoContent.innerHTML = `
                <h3>🏄 Overview</h3>
                <p>${info.description}</p>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Spot Type</div>
                        <div class="info-value">${info.type}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Best Wind</div>
                        <div class="info-value">${info.bestWind}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Water Temperature</div>
                        <div class="info-value">${info.waterTemp}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Experience Level</div>
                        <div class="info-value">${info.experience}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Launch Type</div>
                        <div class="info-value">${info.launch}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Hazards</div>
                        <div class="info-value">${info.hazards}</div>
                    </div>
                </div>
                
                <h3>📅 Season</h3>
                <p>${info.season}</p>
            `;

        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeAIModal() {
        const modal = document.getElementById('aiModal');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    function closeInfoModal() {
        const modal = document.getElementById('infoModal');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    function createSpotCard(spot) {
        const card = document.createElement('div');
        card.className = 'spot-card';
        card.dataset.country = spot.country;

        // Check if spot has wave data
        const hasWaveData = spot.forecast && spot.forecast.some(day => day.wave !== undefined) ||
            (spot.currentConditions && spot.currentConditions.wave !== undefined);

        let forecastRows = '';
        if (spot.forecast && Array.isArray(spot.forecast)) {
            spot.forecast.forEach(day => {
                let windClass, windTextClass;
                if (day.wind < 12) {
                    windClass = 'weak-wind';
                    windTextClass = 'wind-weak';
                } else if (day.wind >= 12 && day.wind < 18) {
                    windClass = 'moderate-wind';
                    windTextClass = 'wind-moderate';
                } else if (day.wind >= 18 && day.wind <= 22) {
                    windClass = 'strong-wind';
                    windTextClass = 'wind-strong';
                } else {
                    windClass = 'extreme-wind';
                    windTextClass = 'wind-extreme';
                }

                const tempClass = day.temp >= 20 ? 'temp-positive' : 'temp-negative';
                const windArrow = getWindArrow(day.direction);
                const precipClass = day.precipitation === 0 ? 'precipitation-none' : 'precipitation';

                // Wave classes
                let waveClass = '';
                let waveText = '-';
                if (day.wave !== undefined) {
                    if (day.wave < 1.0) {
                        waveClass = 'wave-small';
                    } else if (day.wave >= 1.0 && day.wave < 2.0) {
                        waveClass = 'wave-moderate';
                    } else {
                        waveClass = 'wave-large';
                    }
                    waveText = `${day.wave}`;
                }

                forecastRows += `
                        <tr class="${windClass}">
                            <td><strong>${day.date}</strong></td>
                            <td class="${windTextClass}">${day.wind} kts</td>
                            <td class="${windTextClass}">${day.gusts} kts</td>
                            <td class="${windTextClass}">
                                <span class="wind-arrow">${windArrow}</span> ${day.direction}
                            </td>
                            <td class="${tempClass}">${day.temp}°C</td>
                            <td class="${precipClass}">${day.precipitation}%</td>
                            ${hasWaveData ? `<td class="${waveClass}">${waveText}</td>` : ''}
                        </tr>
                    `;
            });
        }

        let currentConditionsRow = '';
        if (spot.currentConditions) {
            let windClass, windTextClass;
            if (spot.currentConditions.wind < 12) {
                windClass = 'weak-wind';
                windTextClass = 'wind-weak';
            } else if (spot.currentConditions.wind >= 12 && spot.currentConditions.wind < 15) {
                windClass = 'moderate-wind';
                windTextClass = 'wind-moderate';
            } else if (spot.currentConditions.wind >= 15 && spot.currentConditions.wind <= 22) {
                windClass = 'strong-wind';
                windTextClass = 'wind-strong';
            } else {
                windClass = 'extreme-wind';
                windTextClass = 'wind-extreme';
            }

            const tempClass = spot.currentConditions.temp >= 20 ? 'temp-positive' : 'temp-negative';
            const windArrow = getWindArrow(spot.currentConditions.direction);

            // Current wave conditions
            let currentWaveClass = '';
            let currentWaveText = '-';
            if (spot.currentConditions.wave !== undefined) {
                if (spot.currentConditions.wave < 1.0) {
                    currentWaveClass = 'wave-small';
                } else if (spot.currentConditions.wave >= 1.0 && spot.currentConditions.wave < 2.0) {
                    currentWaveClass = 'wave-moderate';
                } else {
                    currentWaveClass = 'wave-large';
                }
                currentWaveText = `${spot.currentConditions.wave}`;
            }

            currentConditionsRow = `
                    <tr class="${windClass}" style="border-top: 2px solid #404040;">
                        <td>
                            <div class="live-indicator">
                                <strong>NOW</strong>
                                <div class="live-dot"></div>
                            </div>
                        </td>
                        <td class="${windTextClass}">${spot.currentConditions.wind} kts</td>
                        <td class="${windTextClass}">${spot.currentConditions.gusts} kts</td>
                        <td class="${windTextClass}">
                            <span class="wind-arrow">${windArrow}</span> ${spot.currentConditions.direction}
                        </td>
                        <td class="${tempClass}">${spot.currentConditions.temp}°C</td>
                        <td>-</td>
                        ${hasWaveData ? `<td class="${currentWaveClass}">${currentWaveText}</td>` : ''}
                    </tr>
                `;
        }

        // Check if spot is favorited
        const isFavorited = isFavorite(spot.name);
        const favoriteClass = isFavorited ? 'favorited' : '';

        card.innerHTML = `
                <div class="drag-handle" draggable="true">𓃌</div>
                <div class="favorite-icon ${favoriteClass}" onclick="toggleFavorite('${spot.name}')" title="${isFavorited ? 'Remove from favorites' : 'Add to favorites'}">⭐</div>
                <div class="spot-header">
                    <div class="spot-title">
                        <div class="spot-name">${spot.name || 'Unknown Spot'}</div>
                    </div>
                    <div class="spot-meta">
                        <div class="country-tag">${spot.country || 'Unknown'}</div>
                        <div class="last-updated">${spot.lastUpdated || 'No data'}</div>
                    </div>
                </div>
                <div class="external-links">
                    ${spot.spotInfo ? `<span class="external-link info-link" onclick="openInfoModal('${spot.name}')"></span>` : ''}
                    ${spot.windguruUrl ? `<a href="${spot.windguruUrl}" target="_blank" class="external-link">WG</a>` : ''}
                    ${spot.windfinderUrl ? `<a href="${spot.windfinderUrl}" target="_blank" class="external-link">WF</a>` : ''}
                    ${spot.icmUrl ? `<a href="${spot.icmUrl}" target="_blank" class="external-link">ICM</a>` : ''}
                    ${spot.webcamUrl ? `<a href="${spot.webcamUrl}" target="_blank" class="external-link webcam-link">CAM</a>` : ''}
                    ${spot.locationUrl ? `<a href="${spot.locationUrl}" target="_blank" class="external-link location-link">MAP</a>` : ''}
                    ${spot.aiAnalysis ? `<span class="external-link ai-link" onclick="openAIModal('${spot.name}')">AI</span>` : ''}
                </div>
                <table class="weather-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Wind</th>
                            <th>Gusts</th>
                            <th>Direction</th>
                            <th>Temp</th>
                            <th>Rain</th>
                            ${hasWaveData ? '<th>Wave</th>' : ''}
                        </tr>
                    </thead>
                    <tbody>
                        ${forecastRows}
                        ${currentConditionsRow}
                    </tbody>
                </table>
            `;

        return card;
    }

    let currentFilter = 'all';

    function updateSpotCounter(count) {
        const spotCounterNumber = document.getElementById('spotCounterNumber');
        if (spotCounterNumber) {
            spotCounterNumber.textContent = count;
        }
    }

    function filterSpots(data, countryFilter, searchQuery) {
        let filtered = countryFilter === 'all' ? data : data.filter(spot => spot.country === countryFilter);

        if (searchQuery && searchQuery.trim() !== '') {
            const query = searchQuery.toLowerCase().trim();
            filtered = filtered.filter(spot => {
                return spot.name.toLowerCase().includes(query) ||
                    (spot.country && spot.country.toLowerCase().includes(query));
            });
        }

        return filtered;
    }

    async function renderSpots(filter = 'all', searchQuery = '') {
        currentFilter = filter;
        currentSearchQuery = searchQuery;
        const spotsGrid = document.getElementById('spotsGrid');

        showLoadingMessage();

        try {
            const data = await fetchWeatherData();
            globalWeatherData = data;

            // Populate country dropdown with available countries
            populateCountryDropdown(data);

            const filteredSpots = filterSpots(data, filter, searchQuery);

            spotsGrid.innerHTML = '';
            if (filteredSpots.length === 0) {
                updateSpotCounter(0);
                const message = searchQuery ?
                    `No spots found matching "${searchQuery}"` :
                    'No kitesurfing spots found for the selected filter.';
                spotsGrid.innerHTML = `
                        <div class="error-message">
                            <span class="error-icon">🔍</span>
                            <div class="error-title">No Spots Found</div>
                            <div class="error-description">
                                ${message}<br/>
                                Try adjusting your search or selecting "All" countries.
                            </div>
                        </div>
                    `;
            } else {
                // Check if all spots have empty forecasts
                const allForecastsEmpty = filteredSpots.every(spot =>
                    !spot.forecast || spot.forecast.length === 0
                );

                if (allForecastsEmpty) {
                    spotsGrid.innerHTML = `
                        <div class="loading-message">
                            <div class="loading-spinner"></div>
                            <span class="loading-text">Loading forecasts...</span>
                        </div>
                    `;
                    // Retry loading after 5 seconds
                    setTimeout(() => {
                        renderSpots(filter, searchQuery);
                    }, 5000);
                } else {
                    updateSpotCounter(filteredSpots.length);
                    filteredSpots.forEach(spot => {
                        spotsGrid.appendChild(createSpotCard(spot));
                    });
                    loadCardOrder();
                }
            }
        } catch (error) {
            console.error('Failed to load weather:', error.message);
            showErrorMessage(error);
        }
    }

    function setupDropdownEvents() {
        const dropdownOptions = document.querySelectorAll('.dropdown-option');
        const selectedCountry = document.getElementById('selectedCountry');
        const searchInput = document.getElementById('searchInput');

        dropdownOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                e.stopPropagation();

                dropdownOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');

                selectedCountry.textContent = option.textContent;
                const country = option.dataset.country;

                // Save selected country to localStorage
                localStorage.setItem('selectedCountry', country);

                // Deselect favorites if changing country
                if (showingFavorites) {
                    showingFavorites = false;
                    localStorage.setItem('showingFavorites', 'false');
                    document.getElementById('favoritesToggle').classList.remove('active');
                }

                renderSpots(country, searchInput.value);
                closeDropdown();

                // Scroll to top smoothly after country selection
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
    }

    function setupDropdown() {
        const dropdownButton = document.getElementById('dropdownButton');
        const dropdownMenu = document.getElementById('dropdownMenu');

        function closeDropdown() {
            dropdownButton.classList.remove('open', 'active');
            dropdownMenu.classList.remove('open');
        }

        dropdownButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (dropdownMenu.classList.contains('open')) {
                closeDropdown();
            } else {
                dropdownButton.classList.add('open', 'active');
                dropdownMenu.classList.add('open');
            }
        });

        document.addEventListener('click', (e) => {
            if (!dropdownButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
                closeDropdown();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && dropdownMenu.classList.contains('open')) {
                closeDropdown();
                dropdownButton.focus();
            }
        });

        // Make closeDropdown available globally
        window.closeDropdown = closeDropdown;
    }

    function setupModals() {
        const aiModal = document.getElementById('aiModal');
        const aiCloseButton = document.getElementById('modalClose');
        const infoModal = document.getElementById('infoModal');
        const infoCloseButton = document.getElementById('infoModalClose');

        // AI Modal events
        aiCloseButton.addEventListener('click', closeAIModal);
        aiModal.addEventListener('click', (e) => {
            if (e.target === aiModal) {
                closeAIModal();
            }
        });

        // Info Modal events
        infoCloseButton.addEventListener('click', closeInfoModal);
        infoModal.addEventListener('click', (e) => {
            if (e.target === infoModal) {
                closeInfoModal();
            }
        });

        // Escape key for both modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (aiModal.classList.contains('active')) {
                    closeAIModal();
                }
                if (infoModal.classList.contains('active')) {
                    closeInfoModal();
                }
            }
        });
    }

    function setupSearch() {
        const searchInput = document.getElementById('searchInput');
        const searchClear = document.getElementById('searchClear');
        let searchTimeout;

        searchInput.addEventListener('input', (e) => {
            const value = e.target.value;

            // Show/hide clear button
            if (value.trim() !== '') {
                searchClear.classList.add('visible');
            } else {
                searchClear.classList.remove('visible');
            }

            // Deselect favorites if searching
            if (showingFavorites && value.trim() !== '') {
                showingFavorites = false;
                document.getElementById('favoritesToggle').classList.remove('active');
            }

            // Debounce search
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                renderSpots(currentFilter, value);
            }, 300);
        });

        searchClear.addEventListener('click', () => {
            searchInput.value = '';
            searchClear.classList.remove('visible');
            renderSpots(currentFilter, '');
            searchInput.focus();
        });

        // Clear search on Escape key
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && searchInput.value !== '') {
                searchInput.value = '';
                searchClear.classList.remove('visible');
                renderSpots(currentFilter, '');
            }
        });
    }

    // Drag and drop functionality with persistence
    function setupDragAndDrop() {
        const spotsGrid = document.getElementById('spotsGrid');
        let draggedCard = null;
        let dragGhost = null;

        spotsGrid.addEventListener('dragstart', (e) => {
            const handle = e.target.closest('.drag-handle');
            if (!handle) {
                e.preventDefault();
                return;
            }

            draggedCard = e.target.closest('.spot-card');
            if (draggedCard) {
                draggedCard.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';

                // Create a visual clone of the dragged card
                dragGhost = draggedCard.cloneNode(true);
                dragGhost.classList.add('drag-ghost');
                dragGhost.classList.remove('dragging');
                dragGhost.style.width = draggedCard.offsetWidth + 'px';
                dragGhost.style.position = 'fixed';
                dragGhost.style.left = '-9999px';
                dragGhost.style.top = '-9999px';
                document.body.appendChild(dragGhost);

                // Set the drag image to the clone
                e.dataTransfer.setDragImage(dragGhost, e.offsetX, e.offsetY);
            }
        });

        spotsGrid.addEventListener('dragend', (e) => {
            if (draggedCard) {
                draggedCard.classList.remove('dragging');
                draggedCard = null;
                saveCardOrder();
            }

            // Remove the ghost element
            if (dragGhost) {
                dragGhost.remove();
                dragGhost = null;
            }
        });

        spotsGrid.addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(spotsGrid, e.clientY);
            if (draggedCard && afterElement == null) {
                spotsGrid.appendChild(draggedCard);
            } else if (draggedCard && afterElement) {
                spotsGrid.insertBefore(draggedCard, afterElement);
            }
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.spot-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return {offset: offset, element: child};
                } else {
                    return closest;
                }
            }, {offset: Number.NEGATIVE_INFINITY}).element;
        }
    }

    function saveCardOrder() {
        const spotsGrid = document.getElementById('spotsGrid');
        const cards = spotsGrid.querySelectorAll('.spot-card');
        const order = Array.from(cards).map(card => {
            return card.querySelector('.spot-name').textContent;
        });

        const orderKey = `spotOrder_${currentFilter}_${currentSearchQuery}`;
        localStorage.setItem(orderKey, JSON.stringify(order));
    }

    function loadCardOrder() {
        const orderKey = `spotOrder_${currentFilter}_${currentSearchQuery}`;
        const savedOrder = localStorage.getItem(orderKey);

        if (!savedOrder) return;

        try {
            const order = JSON.parse(savedOrder);
            const spotsGrid = document.getElementById('spotsGrid');
            const cards = Array.from(spotsGrid.querySelectorAll('.spot-card'));

            order.forEach(spotName => {
                const card = cards.find(c => c.querySelector('.spot-name').textContent === spotName);
                if (card) {
                    spotsGrid.appendChild(card);
                }
            });
        } catch (e) {
            console.error('Failed to load card order:', e);
        }
    }

    // Favorites rendering
    async function renderFavorites() {
        showingFavorites = true;
        const favoritesButton = document.getElementById('favoritesToggle');
        favoritesButton.classList.add('active');

        const spotsGrid = document.getElementById('spotsGrid');
        const favorites = getFavorites();

        if (favorites.length === 0) {
            updateSpotCounter(0);
            spotsGrid.innerHTML = `
                <div class="error-message">
                    <span class="error-icon">⭐</span>
                    <div class="error-title">No Favorites Yet</div>
                    <div class="error-description">
                        Click the star icon on any spot card to add it to your favorites.
                    </div>
                </div>
            `;
            return;
        }

        showLoadingMessage();

        try {
            if (globalWeatherData.length === 0) {
                const data = await fetchWeatherData();
                globalWeatherData = data;
            }

            const favoriteSpots = globalWeatherData.filter(spot => favorites.includes(spot.name));

            updateSpotCounter(favoriteSpots.length);
            spotsGrid.innerHTML = '';
            favoriteSpots.forEach(spot => {
                spotsGrid.appendChild(createSpotCard(spot));
            });
            loadCardOrder();
        } catch (error) {
            console.error('Failed to load favorites:', error.message);
            showErrorMessage(error);
        }
    }

    function setupFavorites() {
        const favoritesButton = document.getElementById('favoritesToggle');

        favoritesButton.addEventListener('click', () => {
            if (showingFavorites) {
                // Exit favorites mode
                showingFavorites = false;
                localStorage.setItem('showingFavorites', 'false');
                favoritesButton.classList.remove('active');
                const savedCountry = localStorage.getItem('selectedCountry') || 'all';
                renderSpots(savedCountry, '');
            } else {
                // Enter favorites mode
                localStorage.setItem('showingFavorites', 'true');
                renderFavorites();
            }
        });

        // Restore favorites state on page load
        const savedFavoritesState = localStorage.getItem('showingFavorites');
        if (savedFavoritesState === 'true') {
            renderFavorites();
        }
    }

    // Hamburger menu functionality
    function setupHamburgerMenu() {
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const headerControls = document.getElementById('headerControls');
        const mainContent = document.querySelector('.main-content');

        if (!hamburgerMenu) return;

        hamburgerMenu.addEventListener('click', () => {
            const isOpen = headerControls.classList.contains('show');

            if (isOpen) {
                headerControls.classList.remove('show');
                hamburgerMenu.classList.remove('active');
                hamburgerMenu.textContent = '☰';
                if (mainContent) {
                    mainContent.classList.remove('menu-open');
                }
            } else {
                headerControls.classList.add('show');
                hamburgerMenu.classList.add('active');
                hamburgerMenu.textContent = '✕';
                if (mainContent) {
                    mainContent.classList.add('menu-open');
                }
            }
        });
    }

    // Kite Size Calculator Functionality
    function calculateKiteSize(windSpeed, riderWeight, skillLevel) {
        // Base calculation: kite size (m²) = rider weight (kg) * factor / wind speed (kts)
        let factor = 2.5; // Default factor for intermediate flat water

        // Adjust factor based on skill level and conditions
        const factorAdjustments = {
            'beginner-flat': 3.0,         // Beginners need larger kites
            'beginner-small': 2.8,        // Slightly smaller for small waves
            'intermediate-flat': 2.5,     // Standard factor
            'intermediate-medium': 2.3,   // Medium waves need smaller kites
            'advanced-flat': 2.2,         // Advanced riders can use smaller kites
            'advanced-medium': 2.0,       // Advanced with medium waves
            'advanced-large': 1.8         // Advanced with large waves need smallest kites
        };

        if (skillLevel && factorAdjustments[skillLevel]) {
            factor = factorAdjustments[skillLevel];
        }

        // Calculate base kite size
        let kiteSize = (riderWeight * factor) / windSpeed;

        // Round to nearest common kite size (7, 9, 10, 12, 14, 15, 17 m²)
        const commonSizes = [7, 9, 10, 12, 14, 15, 17];
        kiteSize = commonSizes.reduce((prev, curr) =>
            Math.abs(curr - kiteSize) < Math.abs(prev - kiteSize) ? curr : prev
        );

        return kiteSize;
    }

    function calculateBoardSize(riderWeight, skillLevel, kiteSize) {
        // Determine board type first
        let boardType = 'Twin Tip';
        if (skillLevel.includes('large') || (skillLevel.includes('medium') && skillLevel.includes('advanced'))) {
            boardType = 'Surfboard/Directional 🏄';
        }

        if (boardType === 'Twin Tip') {
            // Twin Tip calculation with realistic sizes (125-160 cm)
            let baseSize = 125; // Minimum realistic size

            // Add size based on weight (up to 115 kg)
            const effectiveWeight = Math.min(riderWeight, 115);
            baseSize += (effectiveWeight - 50) * 0.5; // ~32.5 cm range for 50-115 kg

            // Adjust based on skill level
            const sizeAdjustments = {
                'beginner-flat': 1.15,          // Larger for stability
                'beginner-small': 1.10,
                'intermediate-flat': 1.0,       // Standard size
                'intermediate-medium': 0.98,
                'advanced-flat': 0.92,          // Smaller for maneuverability
                'advanced-medium': 0.90
            };

            const adjustment = sizeAdjustments[skillLevel] || 1.0;
            let boardSize = Math.round(baseSize * adjustment);

            // Round to nearest 2 cm
            boardSize = Math.round(boardSize / 2) * 2;

            // Apply minimum and maximum size constraints
            const minSize = 136; // Minimum board size
            let maxSize = 160; // Default for beginners
            if (skillLevel.includes('intermediate')) {
                maxSize = 142;
            } else if (skillLevel.includes('advanced')) {
                maxSize = 142;
            }
            boardSize = Math.max(minSize, Math.min(boardSize, maxSize));

            // Calculate width (typically 38-46 cm for twin tips)
            let width = 38 + Math.floor((boardSize - 136) / 4);
            width = Math.min(width, 46);

            return `${boardSize} x ${width} cm (${boardType})`;
        } else {
            // Surfboard/Directional sizes (typically 5'4" to 6'2")
            const sizeInFeet = riderWeight < 70 ? "5'6\"" : riderWeight < 85 ? "5'10\"" : "6'0\"";
            return `${sizeInFeet} (${boardType})`;
        }
    }

    function setupKiteSizeCalculator() {
        const kiteSizeButton = document.getElementById('kiteSizeToggle');
        const kiteSizeModal = document.getElementById('kiteSizeModal');
        const kiteSizeCloseButton = document.getElementById('kiteSizeModalClose');
        const calculateBtn = document.getElementById('calculateBtn');

        // Open modal
        kiteSizeButton.addEventListener('click', () => {
            kiteSizeModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Reset result visibility
            document.getElementById('calcResult').classList.remove('show');
        });

        // Close modal
        function closeKiteSizeModal() {
            kiteSizeModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        kiteSizeCloseButton.addEventListener('click', closeKiteSizeModal);

        kiteSizeModal.addEventListener('click', (e) => {
            if (e.target === kiteSizeModal) {
                closeKiteSizeModal();
            }
        });

        // Calculate button
        calculateBtn.addEventListener('click', () => {
            const windSpeed = parseFloat(document.getElementById('windSpeed').value);
            const riderWeight = parseFloat(document.getElementById('riderWeight').value);
            const skillLevel = document.getElementById('skillLevel').value;
            const calcWarning = document.getElementById('calcWarning');
            const calcResult = document.getElementById('calcResult');

            // Hide previous warnings and results
            calcWarning.style.display = 'none';
            calcResult.classList.remove('show');

            // Validation
            if (!windSpeed || windSpeed < 5 || windSpeed > 50) {
                calcWarning.innerHTML = '⚠️ <strong>INVALID WIND SPEED</strong><br><br>Please enter a valid wind speed between 5 and 50 knots.';
                calcWarning.style.display = 'block';
                return;
            }

            if (!riderWeight || riderWeight > 150) {
                calcWarning.innerHTML = '⚠️ <strong>INVALID RIDER WEIGHT</strong><br><br>Please enter a valid rider weight between 40 and 150 kg.';
                calcWarning.style.display = 'block';
                return;
            }

            if (riderWeight < 40) {
                calcWarning.innerHTML = '⚠️ <strong>WEIGHT TOO LOW</strong><br><br>Your weight is too low and riding may be dangerous. Kitesurfing requires sufficient body weight for control and safety.';
                calcWarning.style.display = 'block';
                return;
            }

            if (!skillLevel) {
                calcWarning.innerHTML = '⚠️ <strong>SKILL LEVEL REQUIRED</strong><br><br>Please select your skill level and conditions.';
                calcWarning.style.display = 'block';
                return;
            }

            // Check for warning conditions
            if (riderWeight > 120) {
                calcWarning.innerHTML = '😉 Maybe you should lose some weight before going onto the water!';
                calcWarning.style.display = 'block';
                return;
            }

            if (windSpeed > 40) {
                calcWarning.innerHTML = '⚠️ <strong>EXTREME CONDITIONS!</strong><br><br>Wind speeds above 40 knots are extremely dangerous. We strongly recommend NOT going onto the water in these conditions. Stay safe!';
                calcWarning.style.display = 'block';
                return;
            }

            if (windSpeed < 12) {
                calcWarning.innerHTML = '💨 <strong>LOW WIND CONDITIONS</strong><br><br>There is not enough wind for riding with a regular setup. However, you could try going on a <strong>kite foil board</strong>, which works great in light wind conditions!';
                calcWarning.style.display = 'block';
                return;
            }

            // Check for low wind with medium or large waves
            if (windSpeed < 15 && (skillLevel.includes('medium') || skillLevel.includes('large'))) {
                calcWarning.innerHTML = '🌊 <strong>INSUFFICIENT WIND FOR WAVE CONDITIONS</strong><br><br>Wind speed below 15 knots is not enough for riding in medium or large waves. Waves create additional resistance and you need more wind power to maintain speed and control. We recommend NOT going onto the water in these conditions.';
                calcWarning.style.display = 'block';
                return;
            }

            // Calculate
            const kiteSize = calculateKiteSize(windSpeed, riderWeight, skillLevel);
            const boardSize = calculateBoardSize(riderWeight, skillLevel, kiteSize);

            // Display results
            document.getElementById('kiteSize').textContent = `${kiteSize} m²`;
            document.getElementById('boardSize').textContent = boardSize;
            calcResult.classList.add('show');
        });

        // Escape key support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && kiteSizeModal.classList.contains('active')) {
                closeKiteSizeModal();
            }
        });
    }

    // Make functions global for onclick handlers
    window.openAIModal = openAIModal;
    window.closeAIModal = closeAIModal;
    window.openInfoModal = openInfoModal;
    window.closeInfoModal = closeInfoModal;
    window.toggleFavorite = toggleFavorite;

    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        // Load saved country filter or default to 'all'
        const savedCountry = localStorage.getItem('selectedCountry') || 'all';
        renderSpots(savedCountry);
        setupDropdown();
        setupModals();
        setupSearch();
        setupDragAndDrop();
        setupFavorites();
        setupHamburgerMenu();
        setupKiteSizeCalculator();
    });
</script>
</body>
</html>